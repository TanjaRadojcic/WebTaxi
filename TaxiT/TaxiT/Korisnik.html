<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Pink Taxi</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-pink.css">
    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    

    <link rel="stylesheet" type="text/css" href="Korisnik.css">
    <script src="Scripts/jquery-1.10.2.js"></script>
    <script type="text/javascript">
        let lokacijaMapa = "";
        let blokada = "";
        $(document).ready(function () {
            
            let ulogovani = localStorage.getItem("ulogovani");
            let koje = "";
            let trenutniKorisnik = "";
            localStorage.setItem("zabrana","0");
            $.ajax({
                type: 'POST',
                url: '/api/Find',
                data: JSON.stringify(ulogovani),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data != null) {

                        if (data.Blokiran == true) {
                            localStorage.removeItem("ulogovani");
                            let koje = "";
                            let trenutniKorisnik = "";
                            $(location).attr('href', 'Index.html');
                            
                        }
                        trenutniKorisnik = data;
                        localStorage.setItem("ulogovaniId", data.Id);
                        localStorage.setItem("ulogovaniUloga", data.Uloga);
                        $("#mapa").css("display", "none");
                        switch (data.Uloga) {
                            case 0:
                                koje = "musterija";
                                $(".musterija").css("display", "inline");
                                $("#pregledProfilaDivK").css("display", "none");
                                $("#izmenaProfilaDivK").css("display", "none");
                                $("#dodajVoznjuDivK").css("display", "none");
                                $("#tabelaMojeVoznjeK").css("display", "inline");
                                $("#pretragaK").css("display", "inline");
                                $("#mapa").css("display", "none");
                                
                                $("#homeK").click();
                                $(".dispecer").css("display", "none");

                                $(".vozac").css("display", "none");
                                break;
                            case 1:
                                koje = "dispecer";
                                $(".musterija").css("display", "none");

                                $(".dispecer").css("display", "inline");
                                $("#pregledProfilaDivD").css("display", "none");
                                $("#izmenaProfilaDivD").css("display", "none");
                                $("#dodajVozacaDivD").css("display", "none");
                                $(".vozac").css("display", "none");
                                $("#dodajKomentarD").css("display", "none");
                                $("#prikaziKomentarD").css("display", "none");
                                $("#tabeleD").css("display", "inline");
                                $("#pretragaD1").css("display", "none");
                                $("#pretragaD2").css("display", "none");
                                $("#pretragaD3").css("display", "none");
                                $("#homeD").click();
                                break;
                            case 2:
                                koje = "vozac";
                                $(".dispecer").css("display", "none");

                                $(".musterija").css("display", "none");

                                $(".vozac").css("display", "inline");
                                $("#pregledProfilaDivV").css("display", "none");
                                $("#izmenaProfilaDivV").css("display", "none");
                                $("#dodajKomentarV").css("display", "none");
                                $("#prikaziKomentarV").css("display", "none");
                                $("#tabeleV").css("display", "inline");
                                $("#uspesnaVoznjaV").css("display", "none");
                                $("#dodajKomentarNeuspesnaV").css("display", "none");
                                $("#pretragaV1").css("display", "none");
                                $("#pretragaV2").css("display", "none");

                                localStorage.setItem("ulogovaniTip", data.Automobil.TipAutomobila);
                                localStorage.setItem("ulogovaniStatus", data.Zauzet);
                                $("#homeV").click();


                                break;

                        }

                    } else {
                        $(location).attr('href', 'Index.html');
                    }

                },
                error: function (errorData) {

                }
            })

            let timerId = setInterval(() => {
                //alert(trenutniKorisnik.KorisnickoIme);
                let id = localStorage.getItem("ulogovaniId");
                let uloga = localStorage.getItem("ulogovaniUloga");
                let zauzetVozac = false;

                if (uloga == 0) {
                    $.ajax({
                        type: 'GET',
                        url: '/api/Korisnik/' + id,
                        async: false,
                        success: function (v) {

                            blokada = v.Blokiran;

                        }
                    })

                } else if (uloga == 2) {
                    $.ajax({
                        type: 'GET',
                        url: '/api/Vozac/' + id,
                        async: false,
                        success: function (v) {
                            
                            blokada = v.Blokiran;
                            zauzetVozac = v.Zauzet;
                        }
                    })
                }
                if (uloga != 1) {
                   
                    if (blokada == true) {
                        $(':button:not(.ac)').prop('disabled', true);
                        
                    } else {
                        let z = localStorage.getItem("zabrana");
                        if (z == "0") {
                            $(':button:not(.noBtn)').prop('disabled', false);
                        } else if (z == "1") {
                            $(':button:not(.noBtn)').prop('disabled', true);
                        }
                        if (zauzetVozac == true) {
                            $('.zauzetVozacDugmici').prop('disabled', true);
                        } 
                    }
                }
               

            }, 500);

            $("#odjavaK").click(function () {
                localStorage.removeItem("ulogovani");
                let koje = "";
                let trenutniKorisnik = "";
                $(location).attr('href', 'Index.html');
            });

            $("#homeK").click(function () {

                $("#pregledProfilaDivK").css("display", "none");
                $("#izmenaProfilaDivK").css("display", "none");
                $("#dodajVoznjuDivK").css("display", "none");
                $("#dodajKomentarK").css("display", "none");
                $("#prikaziKomentarK").css("display", "none");
                $("#dodajKomentarOtkaziK").css("display", "none");
                $("#pretragaK").css("display", "inline");
                $("#tabelaMojeVoznjeK").html("");
                $("#mapa").css("display", "none");
                
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    async: false,
                    success: function (data) {

                        let tableOfProducts = "<table  class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\" id=\"musterijaVoznje\"><tr><td colspan=\"13\"  align=\"center\"><b>Moje voznje</b></td></tr><tr><td>Datum</td><td>Početna lokacija</td><td>Odredište</td><td colspan=\"2\">Vozač</td><td colspan=\"2\">Dispečer</td><td>Iznos</td><td>Ocena</td><td>Status</td><td>Komentar</td><td></td><td></td></tr>";
                        for (voznja in data) {
                            if (data[voznja].Musterija == localStorage.getItem("ulogovaniId")) {
                                var date = new Date(data[voznja].Datum);
                                var month = date.getMonth() + 1;
                                var day = date.getDate();
                                var hours = date.getHours();
                                var minutes = date.getMinutes();

                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hours < 10) hours = '0' + hours;
                                if (minutes < 10) minutes = '0' + minutes;

                                var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;

                                let vozacIme = "";
                                let vozacPrezime = "";

                                if (data[voznja].Vozac != -1) {

                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Vozac/' + data[voznja].Vozac,
                                        async: false,
                                        success: function (v) {
                                            vozacIme = v.Ime;
                                            vozacPrezime = v.Prezime;
                                        }
                                    })

                                }

                                let dispIme = "";
                                let dispPrezime = "";

                                if (data[voznja].Dispecer != -1) {

                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Dispecer/' + data[voznja].Dispecer,
                                        async: false,
                                        success: function (v) {
                                            dispIme = v.Ime;
                                            dispPrezime = v.Prezime;
                                        }
                                    })

                                }

                                tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/> ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${data[voznja].Odrediste.Adresa.Ulica} <br/>  ${data[voznja].Odrediste.Adresa.Mesto}</td><td>${vozacIme}</td><td>${vozacPrezime}</td><td>${dispIme}</td><td>${dispPrezime}</td><td>${data[voznja].Iznos}</td>`;
                                tableOfProducts += `<td>${data[voznja].Komentar.Ocena}</td>`;

                                switch (data[voznja].Status) {
                                    case 0:
                                        tableOfProducts += `<td>Kreirana-Na čekanju</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 1:
                                        tableOfProducts += `<td>Formirana</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 2:
                                        tableOfProducts += `<td>Obrađena</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 3:
                                        tableOfProducts += `<td>Prihvaćena</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 4:
                                        tableOfProducts += `<td>Otkazana</td>`;
                                        tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClick(${data[voznja].Id});">Vidi komentar</button ></td>`;

                                        break;
                                    case 5:
                                        tableOfProducts += `<td>Uspešna</td>`;
                                        if (data[voznja].Komentar.Korisnik == -1) {
                                            tableOfProducts += `<td><button id="dodajKomentar${data[voznja].Id}" type="button" onclick="dodajKomentarClick(${data[voznja].Id});">Dodaj komentar</button ></td>`;

                                        } else {
                                            tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClick(${data[voznja].Id});">Vidi komentar</button ></td>`;

                                        }
                                        break;
                                    case 6:
                                        tableOfProducts += `<td>Neuspešna</td>`;
                                        tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClick(${data[voznja].Id});">Vidi komentar</button ></td>`;

                                        break;

                                }

                                if (data[voznja].Status == 0) {

                                    tableOfProducts += `<td><button  id="otkaziVoznju${data[voznja].Id}" type="button" onclick="otkaziVoznjuClick(${data[voznja].Id});">Otkazi Voznju</button></td>`;
                                    tableOfProducts += `<td><button  id="izmeniVoznju${data[voznja].Id}" type="button" onclick="izmeniVoznjuClick(${data[voznja].Id});">Izmeni Voznju</button></td>`;
                                } else {
                                    tableOfProducts += `<td><button class="noBtn" id="otkaziVoznju${data[voznja].Id}" type="button" onclick="otkaziVoznjuClick(${data[voznja].Id});" disabled>Otkazi Voznju</button></td>`;
                                    tableOfProducts += `<td><button class="noBtn" id="izmeniVoznju${data[voznja].Id}" type="button" onclick="izmeniVoznjuClick(${data[voznja].Id});" disabled>Izmeni Voznju</button></td>`;

                                }
                            }
                        }
                        tableOfProducts += "</table>";
                        $("#tabelaMojeVoznjeK").append(tableOfProducts);
                    }
                });


                $("#tabelaMojeVoznjeK").css("display", "inline");


            });
            
            $("#refreshK").click(function () {
                
                document.getElementById('cenaOdK').value = '';
                document.getElementById('cenaDoK').value = '';
                document.getElementById('ocenaPretragaOdK').selectedIndex = 0;
                document.getElementById('ocenaPretragaDoK').selectedIndex = 0;
                document.getElementById('statusPretragaK').selectedIndex = 0;
                document.getElementById('DatumOdK').value = '';
                document.getElementById('DatumDoK').value = '';

                $("#homeK").click();
            });

            $("#pretraziK").click(function () {

                $("#pregledProfilaDivK").css("display", "none");
                $("#izmenaProfilaDivK").css("display", "none");
                $("#dodajVoznjuDivK").css("display", "none");
                $("#dodajKomentarK").css("display", "none");
                $("#prikaziKomentarK").css("display", "none");
                $("#dodajKomentarOtkaziK").css("display", "none");
                $("#pretragaK").css("display", "inline");
                $("#tabelaMojeVoznjeK").html("");

                let e = document.getElementById('statusPretragaK');
                let selValue = e.options[e.selectedIndex].value;
                let statusPretrage = selValue;

                let datumOd = `${$('#DatumOdK').val()}`;
                if (datumOd == "") {
                    var date = new Date("2018-01-01");
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumOd = date.getFullYear() + "-" + month + "-" + day;

                }

                let datumDo = `${$('#DatumDoK').val()}`;
                if (datumDo == "") {
                    var date = new Date();
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumDo = date.getFullYear() + "-" + month + "-" + day;
                }

                let e1 = document.getElementById('ocenaPretragaOdK');
                let selValue1 = e1.options[e1.selectedIndex].value;
                let ocenaOd = selValue1;

                let e2 = document.getElementById('ocenaPretragaDoK');
                let selValue2 = e2.options[e2.selectedIndex].value;
                let ocenaDo = selValue2;

                let cenaOd = `${$('#cenaOdK').val()}`;
                if (cenaOd == "") {
                    cenaOd = 0;
                }

                let cenaDo = `${$('#cenaDoK').val()}`;
                if (cenaDo == "") {
                    cenaDo = 9999;
                }

                let e3 = document.getElementById('SortK');
                let selValue3 = e3.options[e3.selectedIndex].value;
                let sort = selValue3;


                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    async: false,
                    success: function (data) {

                        let tableOfProducts = "<table class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\" id=\"musterijaVoznje\"><tr><td colspan=\"13\" align=\"center\"><b>Moje voznje</b></td></tr><tr><td>Datum</td><td>Početna lokacija</td><td>Odredište</td><td colspan=\"2\">Vozač</td><td colspan=\"2\">Dispečer</td><td>Iznos</td><td>Ocena</td><td>Status</td><td>Komentar</td><td></td><td></td></tr>";
                        for (voznja in data) {
                            if (data[voznja].Musterija == trenutniKorisnik.Id) {
                                var date = new Date(data[voznja].Datum);
                                var month = date.getMonth() + 1;
                                var day = date.getDate();
                                var hours = date.getHours();
                                var minutes = date.getMinutes();

                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hours < 10) hours = '0' + hours;
                                if (minutes < 10) minutes = '0' + minutes;

                                var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;
                                var date2 = date.getFullYear() + "-" + month + "-" + day;

                                let vozacIme = "";
                                let vozacPrezime = "";

                                if (data[voznja].Vozac != -1) {

                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Vozac/' + data[voznja].Vozac,
                                        async: false,
                                        success: function (v) {
                                            vozacIme = v.Ime;
                                            vozacPrezime = v.Prezime;
                                        }
                                    })
                                }

                                let dispIme = "";
                                let dispPrezime = "";

                                if (data[voznja].Dispecer != -1) {
                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Dispecer/' + data[voznja].Dispecer,
                                        async: false,
                                        success: function (v) {
                                            dispIme = v.Ime;
                                            dispPrezime = v.Prezime;
                                        }
                                    })
                                }

                                if ((data[voznja].Status == statusPretrage || statusPretrage == -1) && (date2 >= datumOd && date2 <= datumDo) && (data[voznja].Iznos >= cenaOd && data[voznja].Iznos <= cenaDo) && (data[voznja].Komentar.Ocena >= ocenaOd && data[voznja].Komentar.Ocena <= ocenaDo)) {

                                    tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/>  ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${data[voznja].Odrediste.Adresa.Ulica} <br/>  ${data[voznja].Odrediste.Adresa.Mesto}</td><td>${vozacIme}</td><td>${vozacPrezime}</td><td>${dispIme}</td><td>${dispPrezime}</td><td>${data[voznja].Iznos}</td>`;

                                    tableOfProducts += `<td>${data[voznja].Komentar.Ocena}</td>`;
                                    switch (data[voznja].Status) {
                                        case 0:
                                            tableOfProducts += `<td>Kreirana-Na čekanju</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            break;
                                        case 1:
                                            tableOfProducts += `<td>Formirana</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            break;
                                        case 2:
                                            tableOfProducts += `<td>Obrađena</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            break;
                                        case 3:
                                            tableOfProducts += `<td>Prihvaćena</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            break;
                                        case 4:
                                            tableOfProducts += `<td>Otkazana</td>`;
                                            tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClick(${data[voznja].Id});">Vidi komentar</button ></td>`;

                                            break;
                                        case 5:
                                            tableOfProducts += `<td>Uspešna</td>`;
                                            if (data[voznja].Komentar.Korisnik == -1) {
                                                tableOfProducts += `<td><button id="dodajKomentar${data[voznja].Id}" type="button" onclick="dodajKomentarClick(${data[voznja].Id});">Dodaj komentar</button ></td>`;

                                            } else {
                                                tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClick(${data[voznja].Id});">Vidi komentar</button ></td>`;

                                            }
                                            break;
                                        case 6:
                                            tableOfProducts += `<td>Neuspešna</td>`;
                                            tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClick(${data[voznja].Id});">Vidi komentar</button ></td>`;

                                            break;

                                    }

                                    if (data[voznja].Status == 0) {

                                        tableOfProducts += `<td><button id="otkaziVoznju${data[voznja].Id}" type="button" onclick="otkaziVoznjuClick(${data[voznja].Id});">Otkazi Voznju</button></td>`;
                                        tableOfProducts += `<td><button id="izmeniVoznju${data[voznja].Id}" type="button" onclick="izmeniVoznjuClick(${data[voznja].Id});">Izmeni Voznju</button></td>`;
                                    } else {
                                        tableOfProducts += `<td><button id="otkaziVoznju${data[voznja].Id}" type="button" onclick="otkaziVoznjuClick(${data[voznja].Id});" disabled>Otkazi Voznju</button></td>`;
                                        tableOfProducts += `<td><button id="izmeniVoznju${data[voznja].Id}" type="button" onclick="izmeniVoznjuClick(${data[voznja].Id});" disabled>Izmeni Voznju</button></td>`;

                                    }
                                }
                            }
                        }
                        tableOfProducts += "</table>";
                        $("#tabelaMojeVoznjeK").append(tableOfProducts);
                    }
                });


                $("#tabelaMojeVoznjeK").css("display", "inline");


            });
            
            $("#pregledProfilaK").click(function () {

                $("#pregledProfilaDivK").css("display", "inline");
                $("#izmenaProfilaDivK").css("display", "none");
                $("#dodajVoznjuDivK").css("display", "none");
                $("#tabelaMojeVoznjeK").css("display", "none");
                $("#mapa").css("display", "none");
                
                $("#pretragaK").css("display", "none");

                $("#korisnickoImeK").text(trenutniKorisnik.KorisnickoIme);
                $("#lozinkaK").text(trenutniKorisnik.Lozinka);
                $("#imeK").text(trenutniKorisnik.Ime);
                $("#prezimeK").text(trenutniKorisnik.Prezime);
                if (trenutniKorisnik.Pol == 0) {
                    let musko = "<i class=\"fa fa-mars w3-xlarge\"></i>";
                    $("#polK").html(musko);
                } else {
                    let zensko = "<i class=\"fa fa-venus w3-xlarge\"></i>";
                    $("#polK").html(zensko);
                }
                $("#jmbgK").html(trenutniKorisnik.JMBG);
                $("#kontaktK").html(trenutniKorisnik.Kontakt);
                $("#emailK").html(trenutniKorisnik.Email);

            });

            $("#izmenaProfilaK").click(function () {

                $("#izmenaProfilaDivK").css("display", "inline");
                $("#pregledProfilaDivK").css("display", "none");
                $("#dodajVoznjuDivK").css("display", "none");
                $("#tabelaMojeVoznjeK").css("display", "none");
                $("#pretragaK").css("display", "none");
                $("#mapa").css("display", "none");
                
                let izmena = "<table class=\"w3-large\" border=1>";
                izmena += " <tr><td>Korisničko ime</td><td><input type=\"text\" name=\"KorisnickoIme\" id=\"korisnickoime\" value=\"" + trenutniKorisnik.KorisnickoIme + "\" pattern=\".{4,}\" minlength=\"4\" maxlength=\"13\" required /></td></tr>";
                izmena += " <tr><td>Lozinka</td><td><input type=\"text\" name=\"Lozinka\" id=\"lozinka1\" value=\"" + trenutniKorisnik.Lozinka + "\" pattern=\".{4,}\" minlength=\"4\" maxlength=\"13\" required /></td></tr>";
                izmena += " <tr><td>Ime</td><td><input type=\"text\" name=\"Ime\" id=\"ime1\" value=\"" + trenutniKorisnik.Ime + "\" minlength=\"2\" maxlength=\"13\" pattern=\"^[^0-9]+$\" required /></td></tr>";
                izmena += " <tr><td>Prezime</td><td><input type=\"text\" name=\"Prezime\" value=\"" + trenutniKorisnik.Prezime + "\" id=\"prezime1\" minlength=\"2\" maxlength=\"13\" pattern=\"^[^0-9]+$\" required /></td></tr>";

                izmena += " <tr><td>JMBG</td><td><input type=\"text\" name=\"JMBG\" id=\"jmbg1\" pattern=\"[0-9]{13}\" minlength=\"13\" maxlength=\"13\" value=\"" + trenutniKorisnik.JMBG + "\" required /></td></tr>";
                izmena += " <tr><td>Kontakt</td><td><input type=\"text\" name=\"Kontakt\" id=\"kontakt1\" value=\"" + trenutniKorisnik.Kontakt + "\"  pattern=\"[0-9]{6,14}\" minlength=\"6\" maxlength=\"14\" required /></td></tr>";
                izmena += " <tr><td>Email</td><td><input type=\"email\" name=\"Email\" id=\"email1\" value=\"" + trenutniKorisnik.Email + "\" pattern=\"[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$\" required /></td></tr></table>";

                $("#tabelaIzmenaK").html(izmena);

            });

            $("#izmeniK").click(function () {
                let v = document.getElementById("korisnickoime");
                let v1 = document.getElementById("lozinka1");
                let v2 = document.getElementById("ime1");
                let v3 = document.getElementById("prezime1");
                let v5 = document.getElementById("jmbg1");
                let v6 = document.getElementById("kontakt1");
                let v7 = document.getElementById("email1");
                if (!v.checkValidity() && !v1.checkValidity() && !v2.checkValidity() && !v3.checkValidity() && !v5.checkValidity() && !v6.checkValidity() && !v7.checkValidity()) {
                    alert("Popunite polja za registraciju!");
                } else if (!v.checkValidity() || !v1.checkValidity() || !v2.checkValidity() || !v3.checkValidity() || !v5.checkValidity() || !v6.checkValidity() || !v7.checkValidity()) {
                    let greska = "Niste dobro uneli:\n";
                    if (!v.checkValidity()) {
                        greska += "-Korisničko ime\n";
                    }
                    if (!v1.checkValidity()) {
                        greska += "-Lozinku\n";
                    }
                    if (!v2.checkValidity()) {
                        greska += "-Ime\n";
                    }
                    if (!v3.checkValidity()) {
                        greska += "-Prezime\n";
                    }

                    if (!v5.checkValidity()) {
                        greska += "-JMBG\n";
                    }
                    if (!v6.checkValidity()) {
                        greska += "-Kontakt\n";
                    }
                    if (!v7.checkValidity()) {
                        greska += "-Email\n";
                    }
                    alert(greska);
                } else {
                    let jmbg = `${$('#jmbgVD').val()}`;
                    let danRodjenja = jmbg.substring(0, 2);
                    let mesecRodjenja = jmbg.substring(2, 4);
                    let godinaRodjenja = jmbg.substring(4, 7);
                    danRodjenja = parseInt(danRodjenja);
                    mesecRodjenja = parseInt(mesecRodjenja);
                    godinaRodjenja = parseInt(godinaRodjenja);
                    if (danRodjenja <= 0 || danRodjenja > 31 || mesecRodjenja <= 0 || mesecRodjenja > 12 || (godinaRodjenja > 18 && godinaRodjenja < 900)) {
                        alert("JMBG je neispravan!");
                    } else {

                        let korisnik = {
                            Id: trenutniKorisnik.Id,
                            KorisnickoIme: `${$('#korisnickoime').val()}`,
                            Lozinka: `${$('#lozinka1').val()}`,
                            Ime: `${$('#ime1').val()}`,
                            Prezime: `${$('#prezime1').val()}`,
                            Pol: trenutniKorisnik.Pol,
                            JMBG: `${$('#jmbg1').val()}`,
                            Kontakt: `${$('#kontakt1').val()}`,
                            Email: `${$('#email1').val()}`,
                            Voznje: trenutniKorisnik.Voznje,
                            Uloga: trenutniKorisnik.Uloga,
                        };

                        $.ajax({
                            type: 'PUT',
                            url: '/api/Korisnik/' + trenutniKorisnik.Id,
                            data: JSON.stringify(korisnik),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data) {
                                    alert("Uspešno ste izmenili podatke.");
                                    localStorage.setItem("ulogovani", korisnik.KorisnickoIme);
                                    $(location).attr('href', 'Korisnik.html');
                                }
                                else {
                                    alert("Polja nisu pravilno popunjena ili je korisničko ime zauzeto!");
                                }
                            },
                            error: function (errorData) {

                            }
                        })
                    }
                }
            });
            
            $("#PlusK").click(function () {

                $("#izmenaProfilaDivK").css("display", "none");
                $("#pregledProfilaDivK").css("display", "none");
                $("#dodajVoznjuDivK").css("display", "inline");
                $("#tabelaMojeVoznjeK").css("display", "none");
                $("#pretragaK").css("display", "none");
                $("#mapa").css("display", "inline");

            });

            $("#dodajVoznjuK").click(function () {
                
                let lokacija2 = lokacijaMapa;
                if (lokacija2 == "") {
                    alert("Izaberite lokaciju!");
                } else {


                    lokacijaMapa = "";

                    let e = document.getElementById('autoK');
                    let selValue = e.options[e.selectedIndex].text;

                    let Voznja = {
                        Musterija: trenutniKorisnik.Id,
                        PocetnaLokacija: lokacija2,
                        TipAutomobila: selValue,
                        Status: "Kreirana",

                    };
                    $.ajax({
                        type: 'POST',
                        url: '/api/Voznja',
                        data: JSON.stringify(Voznja),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            if (data) {
                                alert("Uspešno ste dodali vožnju!");
                                $(location).attr('href', 'Korisnik.html');
                            }
                            else {
                                alert("Vožnja nije dodata!");
                            }
                        },
                        error: function (errorData) {

                        }
                    })
                }
            });

            

           


            $("#odjavaD").click(function () {
                localStorage.removeItem("ulogovani");
                let koje = "";
                let trenutniKorisnik = "";
                $(location).attr('href', 'Index.html');
            });

            $("#homeD").click(function () {

                $("#pregledProfilaDivD").css("display", "none");
                $("#izmenaProfilaDivD").css("display", "none");
                $("#dodajVozacaDivD").css("display", "none");
                $("#dodajVoznjuDivD").css("display", "none");
                $("#tabeleD").css("display", "inline");
                $("#dodajKomentarD").css("display", "none");
                $("#prikaziKomentarD").css("display", "none");
                $("#pretragaD1").css("display", "inline");
                $("#pretragaD2").css("display", "none");
                $("#pretragaD3").css("display", "none");
                $("#mapa").css("display", "none");
                $("#obradaVoznjeD").css("display", "none");
                $("#dodajVoznjuD").css("display", "none");
                $("#blokDivD").css("display", "none");
                openCity(event, 'London');
            });

            $("#pregledProfilaD").click(function () {

                $("#pregledProfilaDivD").css("display", "inline");
                $("#izmenaProfilaDivD").css("display", "none");
                $("#dodajVozacaDivD").css("display", "none");
                $("#dodajVoznjuDivD").css("display", "none");
                $("#tabeleD").css("display", "none");
                $("#blokDivD").css("display", "none");
                $("#mapa").css("display", "none");
                $("#dodajVoznjuD").css("display", "none");

                $("#dodajKomentarD").css("display", "none");
                $("#prikaziKomentarD").css("display", "none");
                $("#pretragaD1").css("display", "none");
                $("#pretragaD2").css("display", "none");
                $("#pretragaD3").css("display", "none");
                
                $("#obradaVoznjeD").css("display", "none");
               
                


                $("#korisnickoImeD").text(trenutniKorisnik.KorisnickoIme);
                $("#lozinkaD").text(trenutniKorisnik.Lozinka);
                $("#imeD").text(trenutniKorisnik.Ime);
                $("#prezimeD").text(trenutniKorisnik.Prezime);
                if (trenutniKorisnik.Pol == 0) {
                    let musko = "<i class=\"fa fa-mars w3-xlarge\"></i>";
                    $("#polD").html(musko);
                } else {
                    let zensko = "<i class=\"fa fa-venus w3-xlarge\"></i>";
                    $("#polD").html(zensko);
                }
                $("#jmbgD").html(trenutniKorisnik.JMBG);
                $("#kontaktD").html(trenutniKorisnik.Kontakt);
                $("#emailD").html(trenutniKorisnik.Email);

            });

            $("#izmenaProfilaD").click(function () {

                $("#blokDivD").css("display", "none");
                $("#izmenaProfilaDivD").css("display", "inline");
                $("#pregledProfilaDivD").css("display", "none");
                $("#dodajVozacaDivD").css("display", "none");
                $("#dodajVoznjuDivD").css("display", "none");
                $("#tabeleD").css("display", "none");
                $("#mapa").css("display", "none");
                $("#dodajVoznjuD").css("display", "none");
                
                $("#dodajKomentarD").css("display", "none");
                $("#prikaziKomentarD").css("display", "none");
                $("#pretragaD1").css("display", "none");
                $("#pretragaD2").css("display", "none");
                $("#pretragaD3").css("display", "none");
                
                $("#obradaVoznjeD").css("display", "none");
                
                


                let izmena = "<table class=\"w3-large\" border=1>";
                izmena += " <tr><td>Korisničko ime</td><td><input type=\"text\" name=\"KorisnickoIme\" id=\"korisnickoime\" value=\"" + trenutniKorisnik.KorisnickoIme + "\" pattern=\".{4,}\" minlength=\"4\" maxlength=\"13\" required /></td></tr>";
                izmena += " <tr><td>Lozinka</td><td><input type=\"text\" name=\"Lozinka\" id=\"lozinka1\" value=\"" + trenutniKorisnik.Lozinka + "\" pattern=\".{4,}\" minlength=\"4\" maxlength=\"13\" required /></td></tr>";
                izmena += " <tr><td>Ime</td><td><input type=\"text\" name=\"Ime\" id=\"ime1\" value=\"" + trenutniKorisnik.Ime + "\" minlength=\"2\" maxlength=\"13\" pattern=\"^[^0-9]+$\" required /></td></tr>";
                izmena += " <tr><td>Prezime</td><td><input type=\"text\" name=\"Prezime\" value=\"" + trenutniKorisnik.Prezime + "\" id=\"prezime1\" minlength=\"2\" maxlength=\"13\" pattern=\"^[^0-9]+$\" required /></td></tr>";

                izmena += " <tr><td>JMBG</td><td><input type=\"text\" name=\"JMBG\" id=\"jmbg1\" pattern=\"[0-9]{13}\" minlength=\"13\" maxlength=\"13\" value=\"" + trenutniKorisnik.JMBG + "\" required /></td></tr>";
                izmena += " <tr><td>Kontakt</td><td><input type=\"text\" name=\"Kontakt\" id=\"kontakt1\" minlength=\"6\" value=\"" + trenutniKorisnik.Kontakt + "\" pattern=\"[0-9]{6,14}\" minlength=\"6\" maxlength=\"14\" required /></td></tr>";
                izmena += " <tr><td>Email</td><td><input type=\"email\" name=\"Email\" id=\"email1\" value=\"" + trenutniKorisnik.Email + "\" pattern=\"[a-z0-9._% +-]+@[a-z0-9.-]+\.[a-z]{2,3}$\" required /></td></tr></table>";

                $("#tabelaIzmenaD").html(izmena);

            });

            $("#izmeniD").click(function () {
                let v = document.getElementById("korisnickoime");
                let v1 = document.getElementById("lozinka1");
                let v2 = document.getElementById("ime1");
                let v3 = document.getElementById("prezime1");
                let v5 = document.getElementById("jmbg1");
                let v6 = document.getElementById("kontakt1");
                let v7 = document.getElementById("email1");
                if (!v.checkValidity() && !v1.checkValidity() && !v2.checkValidity() && !v3.checkValidity() && !v5.checkValidity() && !v6.checkValidity() && !v7.checkValidity()) {
                    alert("Popunite polja za registraciju!");
                } else if (!v.checkValidity() || !v1.checkValidity() || !v2.checkValidity() || !v3.checkValidity() || !v5.checkValidity() || !v6.checkValidity() || !v7.checkValidity()) {
                    let greska = "Niste dobro uneli:\n";
                    if (!v.checkValidity()) {
                        greska += "-Korisničko ime\n";
                    }
                    if (!v1.checkValidity()) {
                        greska += "-Lozinku\n";
                    }
                    if (!v2.checkValidity()) {
                        greska += "-Ime\n";
                    }
                    if (!v3.checkValidity()) {
                        greska += "-Prezime\n";
                    }

                    if (!v5.checkValidity()) {
                        greska += "-JMBG\n";
                    }
                    if (!v6.checkValidity()) {
                        greska += "-Kontakt\n";
                    }
                    if (!v7.checkValidity()) {
                        greska += "-Email\n";
                    }
                    alert(greska);
                } else {
                    let jmbg = `${$('#jmbgVD').val()}`;
                    let danRodjenja = jmbg.substring(0, 2);
                    let mesecRodjenja = jmbg.substring(2, 4);
                    let godinaRodjenja = jmbg.substring(4, 7);
                    danRodjenja = parseInt(danRodjenja);
                    mesecRodjenja = parseInt(mesecRodjenja);
                    godinaRodjenja = parseInt(godinaRodjenja);
                    if (danRodjenja <= 0 || danRodjenja > 31 || mesecRodjenja <= 0 || mesecRodjenja > 12 || (godinaRodjenja > 18 && godinaRodjenja < 900)) {
                        alert("JMBG je neispravan!");
                    } else {

                        let korisnik = {
                            Id: trenutniKorisnik.Id,
                            KorisnickoIme: `${$('#korisnickoime').val()}`,
                            Lozinka: `${$('#lozinka1').val()}`,
                            Ime: `${$('#ime1').val()}`,
                            Prezime: `${$('#prezime1').val()}`,
                            Pol: trenutniKorisnik.Pol,
                            JMBG: `${$('#jmbg1').val()}`,
                            Kontakt: `${$('#kontakt1').val()}`,
                            Email: `${$('#email1').val()}`,
                            Voznje: trenutniKorisnik.Voznje,
                            Uloga: trenutniKorisnik.Uloga,
                        };

                        $.ajax({
                            type: 'PUT',
                            url: '/api/Dispecer/' + trenutniKorisnik.Id,
                            data: JSON.stringify(korisnik),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data) {
                                    alert("Uspešno ste izmenili podatke.");
                                    localStorage.setItem("ulogovani", korisnik.KorisnickoIme);
                                    $(location).attr('href', 'Korisnik.html');
                                }
                                else {
                                    alert("Proverite da su sva polja dobro popunjena pa pokušajte opet!\nAko su dobro popunjena korisničko ime je zauzeto!");
                                }
                            },
                            error: function (errorData) {

                            }
                        })
                    }
                }
            });

            $("#PlusD").click(function () {
                $("#blokDivD").css("display", "none");
                $("#izmenaProfilaDivD").css("display", "none");
                $("#pregledProfilaDivD").css("display", "none");
                $("#dodajVozacaDivD").css("display", "inline");
                $("#dodajVoznjuDivD").css("display", "none");
                $("#tabeleD").css("display", "none");
                $("#mapa").css("display", "inline");
                
                $("#dodajKomentarD").css("display", "none");
                $("#prikaziKomentarD").css("display", "none");
                $("#pretragaD1").css("display", "none");
                $("#pretragaD2").css("display", "none");
                $("#pretragaD3").css("display", "none");
                
                $("#obradaVoznjeD").css("display", "none");
                $("#dodajVoznjuD").css("display", "none");
                

            });

            $("#registracijaV").click(function () {
                let v = document.getElementById("korisnickoimeVD");
                let v1 = document.getElementById("lozinkaVD");
                let v2 = document.getElementById("imeVD");
                let v3 = document.getElementById("prezimeVD");
                let v5 = document.getElementById("jmbgVD");
                let v6 = document.getElementById("kontaktVD");
                let v7 = document.getElementById("emailVD");
                let v8 = document.getElementById("godisteVD");
                let v9 = document.getElementById("regVD");
                let v10 = document.getElementById("brVD");
                if (!v.checkValidity() && !v1.checkValidity() && !v2.checkValidity() && !v3.checkValidity() && !v5.checkValidity() && !v6.checkValidity() && !v7.checkValidity() && !v8.checkValidity() && !v9.checkValidity() && !v10.checkValidity()) {
                    alert("Popunite polja za registraciju!");
                } else if (!v.checkValidity() || !v1.checkValidity() || !v2.checkValidity() || !v3.checkValidity() || !v5.checkValidity() || !v6.checkValidity() || !v7.checkValidity()) {
                    let greska = "Niste dobro uneli:\n";
                    if (!v.checkValidity()) {
                        greska += "-Korisničko ime\n";
                    }
                    if (!v1.checkValidity()) {
                        greska += "-Lozinku\n";
                    }
                    if (!v2.checkValidity()) {
                        greska += "-Ime\n";
                    }
                    if (!v3.checkValidity()) {
                        greska += "-Prezime\n";
                    }

                    if (!v5.checkValidity()) {
                        greska += "-JMBG\n";
                    }
                    if (!v6.checkValidity()) {
                        greska += "-Kontakt\n";
                    }
                    if (!v7.checkValidity()) {
                        greska += "-Email\n";
                    }
                    if (!v8.checkValidity()) {
                        greska += "-Godište automobila\n";
                    }
                    if (!v9.checkValidity()) {
                        greska += "-Registracija automobila\n";
                    }
                    if (!v10.checkValidity()) {
                        greska += "-Broj taxi vozila\n";
                    }
                    alert(greska);
                } else if (lokacijaMapa == "") {
                    alert("Izaberite lokaciju!");
                    
                } else {
                    let jmbg = `${$('#jmbgVD').val()}`;
                    let danRodjenja = jmbg.substring(0, 2);
                    let mesecRodjenja = jmbg.substring(2, 4);
                    let godinaRodjenja = jmbg.substring(4, 7);
                    danRodjenja = parseInt(danRodjenja);
                    mesecRodjenja = parseInt(mesecRodjenja);
                    godinaRodjenja = parseInt(godinaRodjenja);
                    if (danRodjenja <= 0 || danRodjenja > 31 || mesecRodjenja <= 0 || mesecRodjenja > 12 || (godinaRodjenja > 18 && godinaRodjenja < 900)) {
                        alert("JMBG je neispravan!");
                    } else {
                        let lokacija2 = lokacijaMapa;
                        lokacijaMapa = "";
                        let e = document.getElementById('tipAutoVD');
                        let selValue = e.options[e.selectedIndex].text;

                        let automobil = {
                            Godiste: `${$('#godisteVD').val()}`,
                            Registracija: `${$('#regVD').val()}`,
                            BrojVozila: `${$('#brVD').val()}`,
                            TipAutomobila: selValue,
                        };

                        let e1 = document.getElementById('polVD');
                        let selValue1 = e.options[e.selectedIndex].text;

                        let vozac = {
                            KorisnickoIme: `${$('#korisnickoimeVD').val()}`,
                            Lozinka: `${$('#lozinkaVD').val()}`,
                            Ime: `${$('#imeVD').val()}`,
                            Prezime: `${$('#prezimeVD').val()}`,
                            Pol: selValue1,
                            JMBG: `${$('#jmbgVD').val()}`,
                            Kontakt: `${$('#kontaktVD').val()}`,
                            Email: `${$('#emailVD').val()}`,
                            Lokacija: lokacija2,
                            Automobil: automobil,

                        };



                        $.ajax({
                            type: 'POST',
                            url: '/api/Vozac',
                            data: JSON.stringify(vozac),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data) {
                                    alert("Registrovali ste vozača sa korisničkim imenom " + vozac.KorisnickoIme);
                                    $(location).attr('href', 'Korisnik.html');
                                }
                                else {
                                    alert("Korisničko ime ili broj vozila je zauzeto!");
                                }
                            },
                            error: function (errorData) {

                            }
                        })
                    }
                }
            });

            $("#PlusVoznjaD").click(function () {
                $("#blokDivD").css("display", "none");
                $("#izmenaProfilaDivD").css("display", "none");
                $("#pregledProfilaDivD").css("display", "none");
                $("#dodajVozacaDivD").css("display", "none");
                $("#tabeleD").css("display", "none");
                $("#mapa").css("display", "inline");

                
                $("#dodajVoznjuDivD").css("display", "none");
               
                $("#dodajKomentarD").css("display", "none");
                $("#prikaziKomentarD").css("display", "none");
                $("#pretragaD1").css("display", "none");
                $("#pretragaD2").css("display", "none");
                $("#pretragaD3").css("display", "none");
                
                $("#obradaVoznjeD").css("display", "none");
                $("#dodajVoznjuD").css("display", "none");
                $("#blokDivD").css("display", "none");


                $("#dodajVoznjuD").html("");


                let tabela = `<table border="1">`;
                //tabela += `<tr><td colspan="2">Lokacija</td></tr> <tr><td>X</td><td><input type="number" name="X" id="xD" required /></td></tr>`;
                //tabela += `<tr><td>Y</td><td><input type="number" name="Y" id="yD" required /></td></tr>`;
                //tabela += `<tr><td colspan="2">Adresa</td></tr><tr><td>Ulica</td><td><input type="text" name="Ulica" id="ulicaD" required /></td></tr>`;
                //tabela += `<tr><td>Broj</td><td><input type="text" name="Broj" id="brojD" required /></td></tr>`;
                //tabela += `<tr><td>Mesto</td><td><input type="text" name="Mesto" id="mestoD" required /></td></tr>`;
                //tabela += `<tr><td>ZIP</td><td><input type="number" name="Zip" id="zipD" required /></td></tr>`;
                tabela += `<tr><td>Tip Automobila</td><td><select name="Auto" id="autoD"><option>Svejedno</option><option>Putnički</option><option>Kombi</option></select></td></tr>`;

                tabela += `<tr><td colspan="2"><button id="dodajVoznjuDugmeD" type="button">Dodaj</button></td></tr></table>`;

                $("#dodajVoznjuD").append(tabela);





                $("#dodajVoznjuD").css("display", "inline");

            });

            $(document).on('click', '#dodajVoznjuDugmeD', function () {
                let listaRastojanja = [];

                let lokacija2 = lokacijaMapa;
                if (lokacija2 == "") {
                    alert("Izaberite lokaciju!");
                } else {
                    
                    let e = document.getElementById('autoD');
                    let selValue = e.options[e.selectedIndex].text;

                    let voznja = {
                        Dispecer: trenutniKorisnik.KorisnickoIme,
                        PocetnaLokacija: lokacija2,
                        TipAutomobila: selValue,
                        Status: "Formirana",

                    };

                    $.ajax({
                        type: 'GET',
                        url: '/api/Vozac',
                        async: false,
                        success: function (data) {
                            let e = document.getElementById('autoD');
                            let selValue = e.options[e.selectedIndex].text;

                            let tip = selValue;
                            let tipBr = "";
                            if (tip == "Svejedno") {
                                tipBr = 0;
                            } else if (tip == "Putnički") {
                                tipBr = 1;
                            } else {
                                tipBr = 2;
                            }


                            let listaPet = [];
                            let listCount = 0;
                            // let c = data.count;
                            if (Object.keys(data).length > 5) {
                                for (vozac in data) {
                                    if ((data[vozac].Automobil.TipAutomobila == tipBr || tipBr == 0) && data[vozac].Zauzet == false) {
                                        var singleObj = {}
                                        singleObj['Id'] = data[vozac].Id;
                                        let rastojanje = Math.sqrt(Math.pow((voznja.PocetnaLokacija.X - data[vozac].Lokacija.X), 2) + Math.pow((voznja.PocetnaLokacija.Y - data[vozac].Lokacija.Y), 2));
                                        singleObj['D'] = rastojanje;
                                        listaRastojanja.push(singleObj);
                                        listCount++;
                                    }
                                }
                                //listaRastojanja.sort(function (a, b) { return a - b });
                                listaRastojanja.sort(function (a, b) { return (a.D > b.D) ? 1 : ((b.D > a.D) ? -1 : 0); });


                                for (let i = 0; i < listCount; i++) {
                                    listaPet.push(listaRastojanja[i].Id);
                                    if (i == 4) {
                                        break;
                                    }
                                }
                            }




                            let tabela = `<table><tr><td>Vozač</td><td><select name="Vozac" id="vozacD">`;
                            let brojac = 0;
                            let jes = true;
                            for (vozac in data) {
                                if (Object.keys(data).length > 5) {
                                    jes = listaPet.includes(data[vozac].Id);
                                }
                                if (data[vozac].Zauzet == false && jes == true) {
                                    if (tipBr == 0) {
                                        tabela += `<option value="${data[vozac].Id}">` + data[vozac].Ime + " " + data[vozac].Prezime + `</option>`;
                                        brojac++;
                                    } else if (data[vozac].Automobil.TipAutomobila == tipBr) {
                                        tabela += `<option value="${data[vozac].Id}">` + data[vozac].Ime + " " + data[vozac].Prezime + `</option>`;
                                        brojac++;
                                    }

                                }
                            }

                            tabela += `</select></td></tr><tr><td colspan="2"><button id="dodajVoznjuDugme2D" type="button">Dodeli</button></td></tr></table>`;
                            if (brojac == 0) {
                                alert("ne postoji slobodan vozač, vožnja neće biti formirana!");
                                $("#dodajVoznjuD").html("");
                                $("#dodajVoznjuD").css("display", "none");
                                $(location).attr('href', 'Korisnik.html');
                            }
                            $("#dodajVoznjuD").append(tabela);
                        }
                    });
                }
            });

            $(document).on('click', '#dodajVoznjuDugme2D', function () {
                
                let lokacija2 = lokacijaMapa;
                lokacijaMapa = "";

                let e = document.getElementById('autoD');
                let selValue = e.options[e.selectedIndex].text;
                let e1 = document.getElementById('vozacD');
                let selValue1 = e1.options[e1.selectedIndex].value;

                let Voznja = {
                    Dispecer: trenutniKorisnik.KorisnickoIme,
                    PocetnaLokacija: lokacija2,
                    TipAutomobila: selValue,
                    Vozac: selValue1,
                    Status: "Formirana",

                };
                $.ajax({
                    type: 'POST',
                    url: '/api/Voznja',
                    data: JSON.stringify(Voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert("Dodata vožnja.");
                            $(location).attr('href', 'Korisnik.html');
                        }
                        else {
                            alert("Vožnja nije dodata!");
                        }
                    },
                    error: function (errorData) {

                    }
                })
            });

            $("#refreshD1").click(function () {


                $("#pretragaD1").css("display", "inline");
                document.getElementById('cenaOdD1').value = '';
                document.getElementById('cenaDoD1').value = '';
                document.getElementById('imeD1').value = '';
                document.getElementById('prezimeD1').value = '';
                document.getElementById('ocenaPretragaOdD1').selectedIndex = 0;
                document.getElementById('ocenaPretragaDoD1').selectedIndex = 0;
                document.getElementById('statusPretragaD1').selectedIndex = 0;
                document.getElementById('DatumOdD1').value = '';
                document.getElementById('DatumDoD1').value = '';

                $("#pretraziD1").click();
            });

            $("#refreshD2").click(function () {


                $("#pretragaD2").css("display", "inline");
                document.getElementById('cenaOdD2').value = '';
                document.getElementById('cenaDoD2').value = '';
                document.getElementById('imeD2').value = '';
                document.getElementById('prezimeD2').value = '';
                document.getElementById('ocenaPretragaOdD2').selectedIndex = 0;
                document.getElementById('ocenaPretragaDoD2').selectedIndex = 0;
                document.getElementById('statusPretragaD2').selectedIndex = 0;
                document.getElementById('DatumOdD2').value = '';
                document.getElementById('DatumDoD2').value = '';

                $("#pretraziD2").click();
            });

            $("#refreshD3").click(function () {


                $("#pretragaD3").css("display", "inline");
               
                document.getElementById('imeD3').value = '';
                document.getElementById('prezimeD3').value = '';
               
                document.getElementById('DatumOdD3').value = '';
                document.getElementById('DatumDoD3').value = '';

                $("#pretraziD3").click();

            });

            $("#pretraziD1").click(function () {
                $("#pretragaD2").css("display", "none");
                $("#pretragaD3").css("display", "none");
                let id = localStorage.getItem("ulogovaniId");

                let e = document.getElementById('statusPretragaD1');
                let selValue = e.options[e.selectedIndex].value;
                let statusPretrage = selValue;

                let datumOd = `${$('#DatumOdD1').val()}`;
                if (datumOd == "") {
                    var date = new Date("2018-01-01");
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumOd = date.getFullYear() + "-" + month + "-" + day;

                }

                let datumDo = `${$('#DatumDoD1').val()}`;
                if (datumDo == "") {
                    var date = new Date();
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumDo = date.getFullYear() + "-" + month + "-" + day;
                }

                let e1 = document.getElementById('ocenaPretragaOdD1');
                let selValue1 = e1.options[e1.selectedIndex].value;
                let ocenaOd = selValue1;

                let e2 = document.getElementById('ocenaPretragaDoD1');
                let selValue2 = e2.options[e2.selectedIndex].value;
                let ocenaDo = selValue2;

                let cenaOd = `${$('#cenaOdD1').val()}`;
                if (cenaOd == "") {
                    cenaOd = 0;
                }

                let cenaDo = `${$('#cenaDoD1').val()}`;
                if (cenaDo == "") {
                    cenaDo = 9999;
                }

                let e3 = document.getElementById('SortD1');
                let selValue3 = e3.options[e3.selectedIndex].value;
                let sort = selValue3;

                let e4 = document.getElementById('ulogaPretragaD1');
                let selValue4 = e4.options[e4.selectedIndex].value;
                let uloga = selValue4;

                let ime = `${$('#imeD1').val()}`;
                let prezime = `${$('#prezimeD1').val()}`;

                $("#London").html("");
                $("#Paris").html("");
                $("#Tokyo").html("");

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    async: false,
                    success: function (data) {
                        let ulogovani = localStorage.getItem("ulogovaniId");
                        let tableOfProducts = "<table class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\"><tr><td>Datum</td><td>Početna lokacija</td><td>Odredište</td><td colspan=\"2\">Vozač</td><td colspan=\"2\">Mušterija</td><td>Iznos</td> <td>Status</td> <td>Komentar</td></tr>";
                        for (voznja in data) {
                            if (data[voznja].Dispecer == ulogovani) {
                                var date = new Date(data[voznja].Datum);
                                var month = date.getMonth() + 1;
                                var day = date.getDate();
                                var hours = date.getHours();
                                var minutes = date.getMinutes();

                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hours < 10) hours = '0' + hours;
                                if (minutes < 10) minutes = '0' + minutes;

                                var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;
                                var date2 = date.getFullYear() + "-" + month + "-" + day;

                                let vozacIme = "";
                                let vozacPrezime = "";

                                if (data[voznja].Vozac != -1) {
                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Vozac/' + data[voznja].Vozac,
                                        async: false,
                                        success: function (v) {
                                            vozacIme = v.Ime;
                                            vozacPrezime = v.Prezime;
                                        }
                                    })
                                }

                                let korIme = "";
                                let korPrezime = "";

                                if (data[voznja].Musterija != -1) {
                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Korisnik/' + data[voznja].Musterija,
                                        async: false,
                                        success: function (v) {
                                            korIme = v.Ime;
                                            korPrezime = v.Prezime;
                                        }
                                    })
                                }

                                ime = ime.toLowerCase();
                                prezime = prezime.toLowerCase();
                                let kIme = "";
                                let kPrezime = "";
                                if (uloga == 0) {
                                    kIme = korIme.toLowerCase();
                                    kPrezime = korPrezime.toLowerCase();
                                } else {
                                    kIme = vozacIme.toLowerCase();
                                    kPrezime = vozacPrezime.toLowerCase();
                                }
                                //&& (kIme.includes(ime) || ime == "") && (kPrezime.includes(prezime) || prezime == "")


                                if ((data[voznja].Status == statusPretrage || statusPretrage == -1) && (kIme.includes(ime) || ime == "") && (kPrezime.includes(prezime) || prezime == "") && (date2 >= datumOd && date2 <= datumDo) && (data[voznja].Iznos >= cenaOd && data[voznja].Iznos <= cenaDo) && (data[voznja].Komentar.Ocena >= ocenaOd && data[voznja].Komentar.Ocena <= ocenaDo)) {
                                    tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/>  ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${data[voznja].Odrediste.Adresa.Ulica} <br/>  ${data[voznja].Odrediste.Adresa.Mesto}</td><td>${vozacIme}</td><td>${vozacPrezime}</td><td>${korIme}</td><td>${korPrezime}</td><td>${data[voznja].Iznos}</td>`;


                                    switch (data[voznja].Status) {
                                        case 0:
                                            tableOfProducts += `<td>Kreirana-Na čekanju</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            break;
                                        case 1:
                                            tableOfProducts += `<td>Formirana</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            break;
                                        case 2:
                                            tableOfProducts += `<td>Obrađena</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            break;
                                        case 3:
                                            tableOfProducts += `<td>Prihvaćena</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            break;
                                        case 4:
                                            tableOfProducts += `<td>Otkazana</td>`;
                                            tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                            break;
                                        case 5:
                                            tableOfProducts += `<td>Uspešna</td>`;
                                            if (data[voznja].Komentar.Korisnik == -1) {
                                                tableOfProducts += `<td><button id="dodajKomentar${data[voznja].Id}" type="button" onclick="dodajKomentarClickD(${data[voznja].Id});">Dodaj komentar</button></td>`;

                                            } else {
                                                tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                            }
                                            break;
                                        case 6:
                                            tableOfProducts += `<td>Neuspešna</td>`;
                                            tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                            break;

                                    }
                                }

                            }
                        }
                        tableOfProducts += "</table>";
                        $("#London").append(tableOfProducts);
                    }
                })

                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                document.getElementById("London").style.display = "block";
                event.currentTarget.className += " active";

            });

            $("#pretraziD2").click(function () {
                $("#pretragaD1").css("display", "none");
                $("#pretragaD3").css("display", "none");
                let id = localStorage.getItem("ulogovaniId");

                let e = document.getElementById('statusPretragaD2');
                let selValue = e.options[e.selectedIndex].value;
                let statusPretrage = selValue;

                let datumOd = `${$('#DatumOdD2').val()}`;
                if (datumOd == "") {
                    var date = new Date("2018-01-01");
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumOd = date.getFullYear() + "-" + month + "-" + day;

                }

                let datumDo = `${$('#DatumDoD2').val()}`;
                if (datumDo == "") {
                    var date = new Date();
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumDo = date.getFullYear() + "-" + month + "-" + day;
                }

                let e1 = document.getElementById('ocenaPretragaOdD2');
                let selValue1 = e1.options[e1.selectedIndex].value;
                let ocenaOd = selValue1;

                let e2 = document.getElementById('ocenaPretragaDoD2');
                let selValue2 = e2.options[e2.selectedIndex].value;
                let ocenaDo = selValue2;

                let cenaOd = `${$('#cenaOdD2').val()}`;
                if (cenaOd == "") {
                    cenaOd = 0;
                }

                let cenaDo = `${$('#cenaDoD2').val()}`;
                if (cenaDo == "") {
                    cenaDo = 9999;
                }

                let e3 = document.getElementById('SortD2');
                let selValue3 = e3.options[e3.selectedIndex].value;
                let sort = selValue3;

                let e4 = document.getElementById('ulogaPretragaD2');
                let selValue4 = e4.options[e4.selectedIndex].value;
                let uloga = selValue4;

                let ime = `${$('#imeD2').val()}`;
                let prezime = `${$('#prezimeD2').val()}`;

                $("#London").html("");
                $("#Paris").html("");
                $("#Tokyo").html("");

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    async: false,
                    success: function (data) {
                        
                        let tableOfProducts = "<table class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\"><tr><td>Datum</td> <td>Početna lokacija</td> <td>Odredište</td> <td colspan=\"2\">Vozač</td><td colspan=\"2\">Mušterija</td> <td colspan=\"2\">Dispečer</td> <td>Iznos</td><td>Ocena</td> <td>Status</td> <td>Komentar</td></tr>";
                        for (voznja in data) {
                            var date = new Date(data[voznja].Datum);
                            var month = date.getMonth() + 1;
                            var day = date.getDate();
                            var hours = date.getHours();
                            var minutes = date.getMinutes();

                            if (month < 10) month = '0' + month;
                            if (day < 10) day = '0' + day;
                            if (hours < 10) hours = '0' + hours;
                            if (minutes < 10) minutes = '0' + minutes;

                            var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;
                            var date2 = date.getFullYear() + "-" + month + "-" + day;

                            let vozacIme = "";
                            let vozacPrezime = "";

                            if (data[voznja].Vozac != -1) {
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Vozac/' + data[voznja].Vozac,
                                    async: false,
                                    success: function (v) {
                                        vozacIme = v.Ime;
                                        vozacPrezime = v.Prezime;
                                    }
                                })
                            }

                            let dispIme = "";
                            let dispPrezime = "";

                            if (data[voznja].Dispecer != -1) {
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Dispecer/' + data[voznja].Dispecer,
                                    async: false,
                                    success: function (v) {
                                        dispIme = v.Ime;
                                        dispPrezime = v.Prezime;
                                    }
                                })
                            }
                            let korIme = "";
                            let korPrezime = "";

                            if (data[voznja].Musterija != -1) {
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Korisnik/' + data[voznja].Musterija,
                                    async: false,
                                    success: function (v) {
                                        korIme = v.Ime;
                                        korPrezime = v.Prezime;
                                    }
                                })
                            }

                            ime = ime.toLowerCase();
                            prezime = prezime.toLowerCase();
                            let kIme = ""; 
                            let kPrezime = "";
                            if (uloga == 0) {
                                kIme = korIme.toLowerCase();
                                kPrezime = korPrezime.toLowerCase();
                            } else {
                                kIme = vozacIme.toLowerCase();
                                kPrezime = vozacPrezime.toLowerCase();
                            }
                                //&& (kIme.includes(ime) || ime == "") && (kPrezime.includes(prezime) || prezime == "")

                            if ((data[voznja].Status == statusPretrage || statusPretrage == -1) && (kIme.includes(ime) || ime == "") && (kPrezime.includes(prezime) || prezime == "") && (date2 >= datumOd && date2 <= datumDo) && (data[voznja].Iznos >= cenaOd && data[voznja].Iznos <= cenaDo) && (data[voznja].Komentar.Ocena >= ocenaOd && data[voznja].Komentar.Ocena <= ocenaDo)) {

                                tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/>  ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${data[voznja].Odrediste.Adresa.Ulica} <br/>  ${data[voznja].Odrediste.Adresa.Mesto}</td><td>${vozacIme}</td><td>${vozacPrezime}</td><td>${korIme}</td><td>${korPrezime}</td><td>${dispIme}</td><td>${dispPrezime}</td><td>${data[voznja].Iznos}</td><td>${data[voznja].Komentar.Ocena}</td>`;

                                switch (data[voznja].Status) {
                                    case 0:
                                        tableOfProducts += `<td>Kreirana-Na čekanju</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 1:
                                        tableOfProducts += `<td>Formirana</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 2:
                                        tableOfProducts += `<td>Obrađena</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 3:
                                        tableOfProducts += `<td>Prihvaćena</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 4:
                                        tableOfProducts += `<td>Otkazana</td>`;
                                        tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                        break;
                                    case 5:
                                        tableOfProducts += `<td>Uspešna</td>`;
                                        if (data[voznja].Komentar.Korisnik == -1) {
                                            tableOfProducts += `<td><button id="dodajKomentar${data[voznja].Id}" type="button" onclick="dodajKomentarClickD(${data[voznja].Id});">Dodaj komentar</button></td>`;

                                        } else {
                                            tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                        }
                                        break;
                                    case 6:
                                        tableOfProducts += `<td>Neuspešna</td>`;
                                        tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                        break;

                                }
                            }

                        }
                        tableOfProducts += "</table>";
                        $("#Paris").append(tableOfProducts);

                    }
                })
                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                document.getElementById("Paris").style.display = "block";
                event.currentTarget.className += " active";
            });

            $("#pretraziD3").click(function () {
                $("#pretragaD1").css("display", "none");
                $("#pretragaD2").css("display", "none");
                let id = localStorage.getItem("ulogovaniId");

                

                let datumOd = `${$('#DatumOdD3').val()}`;
                if (datumOd == "") {
                    var date = new Date("2018-01-01");
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumOd = date.getFullYear() + "-" + month + "-" + day;

                }

                let datumDo = `${$('#DatumDoD3').val()}`;
                if (datumDo == "") {
                    var date = new Date();
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumDo = date.getFullYear() + "-" + month + "-" + day;
                }
                

                let e3 = document.getElementById('SortD3');
                let selValue3 = e3.options[e3.selectedIndex].value;
                let sort = selValue3;

                let e4 = document.getElementById('ulogaPretragaD3');
                let selValue4 = e4.options[e4.selectedIndex].value;
                let uloga = selValue4;

                let ime = `${$('#imeD3').val()}`;
                let prezime = `${$('#prezimeD3').val()}`;

                $("#London").html("");
                $("#Paris").html("");
                $("#Tokyo").html("");

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    async: false,
                    success: function (data) {

                        let tableOfProducts = "<table class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\"><tr><td>Datum</td> <td>Početna lokacija</td> <td colspan=\"2\">Mušterija</td> <td>Tip Automobila</td></tr>";
                        for (voznja in data) {
                            if (data[voznja].Status == 0) {
                                var date = new Date(data[voznja].Datum);
                                var month = date.getMonth() + 1;
                                var day = date.getDate();
                                var hours = date.getHours();
                                var minutes = date.getMinutes();

                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hours < 10) hours = '0' + hours;
                                if (minutes < 10) minutes = '0' + minutes;

                                var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;
                                var date2 = date.getFullYear() + "-" + month + "-" + day;

                                let korIme = "";
                                let korPrezime = "";
                                let korUloga = "";

                                if (data[voznja].Musterija != -1) {
                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Korisnik/' + data[voznja].Musterija,
                                        async: false,
                                        success: function (v) {
                                            korIme = v.Ime;
                                            korPrezime = v.Prezime;
                                            
                                        }
                                    })
                                }
                                ime = ime.toLowerCase();
                                prezime = prezime.toLowerCase();
                                let kIme = korIme.toLowerCase();
                                let kPrezime = korPrezime.toLowerCase();
                                //&& (kIme.includes(ime) || ime == "") && (kPrezime.includes(prezime) || prezime == "")
                                if ((date2 >= datumOd && date2 <= datumDo) && (kIme.includes(ime) || ime == "") && (kPrezime.includes(prezime) || prezime == "") ) {
                                    tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/>  ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${korIme}</td><td>${korPrezime}</td>`;
                                    if (data[voznja].TipAutomobila == 0) {
                                        tableOfProducts += `<td>Svejedno</td>`;
                                    } else if (data[voznja].TipAutomobila == 1) {
                                        tableOfProducts += `<td>Putnički</td>`;
                                    } else if (data[voznja].TipAutomobila == 2) {
                                        tableOfProducts += `<td>Kombi</td>`;
                                    }

                                    tableOfProducts += `<td><button id="obradi${data[voznja].Id}" type="button" onclick="obradiVoznjuClick(${data[voznja].Id});">Obradi Vožnju</button></td>`;
                                }
                            }
                        }
                        tableOfProducts += "</table>";
                        $("#Tokyo").append(tableOfProducts);

                    }
                })

                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                document.getElementById("Tokyo").style.display = "block";
                event.currentTarget.className += " active";

            });

            $("#blokVD").click(function () {
                $("#izmenaProfilaDivD").css("display", "none");
                $("#pregledProfilaDivD").css("display", "none");
                $("#dodajVozacaDivD").css("display", "none");
                $("#dodajVoznjuDivD").css("display", "none");
                $("#tabeleD").css("display", "none");
                $("#mapa").css("display", "none");
                
                $("#dodajKomentarD").css("display", "none");
                $("#prikaziKomentarD").css("display", "none");
                $("#pretragaD1").css("display", "none");
                $("#pretragaD2").css("display", "none");
                $("#pretragaD3").css("display", "none");
                
                $("#obradaVoznjeD").css("display", "none");
                $("#dodajVoznjuD").css("display", "none");
                $("#blokDivD").css("display", "none");


                $("#blokDivD").html("");

                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac',
                    async: false,
                    success: function (data) {
                        
                        let tabela = `<table class="w3-card w3-white"><tr><td colspan = "3">Lista Vozača</td></tr>`;
                        
                        for (vozac in data) {
                            if (data[vozac].Blokiran == false) {
                                tabela += `<tr><td>` + data[vozac].Ime + " " + data[vozac].Prezime + `</td>
                                <td><button id="bVD${data[vozac].Id}" onclick="blokirajVozaca(${data[vozac].Id});" type="button">Blokiraj</button></td>
                                <td><button id="obVD${data[vozac].Id}" onclick="odblokirajVozaca(${data[vozac].Id});" type="button" disabled>Odblokiraj</button></td>`;

                            }
                            else {
                                tabela += `<tr><td>` + data[vozac].Ime + " " + data[vozac].Prezime + `</td>
                                <td><button id="bVD${data[vozac].Id}" onclick="blokirajVozaca(${data[vozac].Id});" type="button" disabled>Blokiraj</button></td>
                                <td><button id="obVD${data[vozac].Id}" onclick="odblokirajVozaca(${data[vozac].Id});" type="button" >Odblokiraj</button></td>`;

                            }
                        }
                        
                        $("#blokDivD").append(tabela);
                    }
                });


                $("#blokDivD").css("display", "inline");
                
            });

            $("#blokKD").click(function () {
                $("#izmenaProfilaDivD").css("display", "none");
                $("#pregledProfilaDivD").css("display", "none");
                $("#dodajVozacaDivD").css("display", "none");
                $("#dodajVoznjuDivD").css("display", "none");
                $("#tabeleD").css("display", "none");
                $("#mapa").css("display", "none");
                
                $("#dodajKomentarD").css("display", "none");
                $("#prikaziKomentarD").css("display", "none");
                $("#pretragaD1").css("display", "none");
                $("#pretragaD2").css("display", "none");
                $("#pretragaD3").css("display", "none");
                
                $("#obradaVoznjeD").css("display", "none");
                $("#dodajVoznjuD").css("display", "none");
                $("#blokDivD").css("display", "none");


                $("#blokDivD").html("");
                $("#blokDivD").css("display", "inline");
                $.ajax({
                    type: 'GET',
                    url: '/api/Korisnik',
                    async: false,
                    success: function (data) {

                        let tabela = `<table class="w3-card w3-white "><tr><td colspan = "3">Lista Mušterija</td></tr>`;

                        for (vozac in data) {
                            if (data[vozac].Blokiran == false) {
                                tabela += `<tr><td>` + data[vozac].Ime + " " + data[vozac].Prezime + `</td>
                                <td><button id="bKD${data[vozac].Id}" onclick="blokirajKorisnika(${data[vozac].Id});" type="button">Blokiraj</button></td>
                                <td><button id="obKD${data[vozac].Id}" onclick="odblokirajKorisnika(${data[vozac].Id});" type="button" disabled>Odblokiraj</button></td>`;

                            }
                            else {
                                tabela += `<tr><td>` + data[vozac].Ime + " " + data[vozac].Prezime + `</td>
                                <td><button id="bKD${data[vozac].Id}" onclick="blokirajKorisnika(${data[vozac].Id});" type="button" disabled>Blokiraj</button></td>
                                <td><button id="obKD${data[vozac].Id}" onclick="odblokirajKorisnika(${data[vozac].Id});" type="button" >Odblokiraj</button></td>`;

                            }
                        }

                        $("#blokDivD").append(tabela);
                    }
                });


                
                
            });





            $("#odjavaV").click(function () {
                localStorage.removeItem("ulogovani");
                let koje = "";
                let trenutniKorisnik = "";
                $(location).attr('href', 'Index.html');
            });

            $("#homeV").click(function () {
               
                $("#pregledProfilaDivV").css("display", "none");
                $("#izmenaProfilaDivV").css("display", "none");
                $("#mapa").css("display", "none");
                $("#dodajKomentarV").css("display", "none");
                $("#prikaziKomentarV").css("display", "none");
                $("#uspesnaVoznjaV").css("display", "none");
                $("#tabeleV").css("display", "inline");
                $("#dodajKomentarNeuspesnaV").css("display", "none");
                $("#pretragaV1").css("display", "none");
                $("#pretragaV2").css("display", "none");
                openCityV(event, 'LondonV');

            });

            $("#pregledProfilaV").click(function () {

                $("#pregledProfilaDivV").css("display", "inline");
                $("#izmenaProfilaDivV").css("display", "none");
                $("#dodajKomentarV").css("display", "none");
                $("#prikaziKomentarV").css("display", "none");
                $("#tabeleV").css("display", "none");
                $("#uspesnaVoznjaV").css("display", "none");
                $("#pretragaV1").css("display", "none");
                $("#pretragaV2").css("display", "none");
                $("#mapa").css("display", "none");

                $("#korisnickoImeV").text(trenutniKorisnik.KorisnickoIme);
                $("#lozinkaV").text(trenutniKorisnik.Lozinka);
                $("#imeV").text(trenutniKorisnik.Ime);
                $("#prezimeV").text(trenutniKorisnik.Prezime);
                if (trenutniKorisnik.Pol == 0) {
                    let musko = "<i class=\"fa fa-mars w3-xlarge\"></i>";
                    $("#polV").html(musko);
                } else {
                    let zensko = "<i class=\"fa fa-venus w3-xlarge\"></i>";
                    $("#polV").html(zensko);
                }
                $("#jmbgV").html(trenutniKorisnik.JMBG);
                $("#kontaktV").html(trenutniKorisnik.Kontakt);
                $("#emailV").html(trenutniKorisnik.Email);
                $("#lokacijaV").html(trenutniKorisnik.Lokacija.Adresa.Ulica + " " + trenutniKorisnik.Lokacija.Adresa.Broj);
                if (trenutniKorisnik.Automobil.TipAutomobila == 0) {
                    $("#automobilV").html("Putnički");
                } else {
                    $("#automobilV").html("Kombi");
                }


            });

            $("#izmenaProfilaV").click(function () {
                $("#mapa").css("display", "none");
                $("#izmenaProfilaDivV").css("display", "inline");
                $("#pregledProfilaDivV").css("display", "none");
                $("#dodajKomentarV").css("display", "none");
                $("#prikaziKomentarV").css("display", "none");
                $("#tabeleV").css("display", "none");
                $("#uspesnaVoznjaV").css("display", "none");
                $("#pretragaV1").css("display", "none");
                $("#pretragaV2").css("display", "none");
                $("#mapa").css("display", "inline");

                let izmena = "<table class=\"w3-large\" border=1>";
                izmena += " <tr><td>Korisničko ime</td><td><input type=\"text\" name=\"KorisnickoIme\" id=\"korisnickoime\" value=\"" + trenutniKorisnik.KorisnickoIme + "\" pattern=\".{4,}\" minlength=\"4\" maxlength=\"13\" required /></td></tr>";
                izmena += " <tr><td>Lozinka</td><td><input type=\"text\" name=\"Lozinka\" id=\"lozinka1\" value=\"" + trenutniKorisnik.Lozinka + "\" pattern=\".{4,}\" minlength=\"4\" maxlength=\"13\" required /></td></tr>";
                izmena += " <tr><td>Ime</td><td><input type=\"text\" name=\"Ime\" id=\"ime1\" value=\"" + trenutniKorisnik.Ime + "\" minlength=\"2\" maxlength=\"13\" pattern=\"^[^0-9]+$\" required /></td></tr>";
                izmena += " <tr><td>Prezime</td><td><input type=\"text\" name=\"Prezime\" value=\"" + trenutniKorisnik.Prezime + "\" id=\"prezime1\" minlength=\"2\" maxlength=\"13\" pattern=\"^[^0-9]+$\" required /></td></tr>";

                izmena += " <tr><td>JMBG</td><td><input type=\"text\" name=\"JMBG\" id=\"jmbg1\" pattern=\"[0-9]{13}\" minlength=\"13\" maxlength=\"13\" value=\"" + trenutniKorisnik.JMBG + "\" required /></td></tr>";
                izmena += " <tr><td>Kontakt</td><td><input type=\"text\" name=\"Kontakt\" id=\"kontakt1\" pattern=\"[0-9]{6,14}\" minlength=\"6\" maxlength=\"14\" value=\"" + trenutniKorisnik.Kontakt + "\" required /></td></tr>";
                izmena += " <tr><td>Email</td><td><input type=\"email\" name=\"Email\" id=\"email1\" value=\"" + trenutniKorisnik.Email + "\" pattern=\"[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$\" required /></td></tr>";
                //izmena += " <tr><td colspan=\"2\">Lokacija</td></tr><tr><td>X</td><td><input type=\"number\" name=\"X\" id=\"xV\" value=\"" + trenutniKorisnik.Lokacija.X + "\" required /></td ></tr > ";
                //izmena += " <tr><td>Y</td><td><input type=\"number\" name=\"Y\" id=\"yV\" value=\"" + trenutniKorisnik.Lokacija.Y + "\" required /></td ></tr >";
                izmena += " <tr><td colspan=\"2\">Adresa</td></tr><tr><td>Ulica</td><td><input type=\"text\" name=\"Ulica\" id=\"ulicaV\" value=\"" + trenutniKorisnik.Lokacija.Adresa.Ulica + "\" readonly /></td ></tr >";
                //izmena += " <tr><td>Broj</td><td><input type=\"text\" name=\"Broj\" id=\"brojV\" value=\"" + trenutniKorisnik.Lokacija.Adresa.Broj + "\" required /></td ></tr>";
                izmena += " <tr><td>Mesto</td><td><input type=\"text\" name=\"Mesto\" id=\"mestoV\" value=\"" + trenutniKorisnik.Lokacija.Adresa.Mesto + "\" readonly /></td ></tr>";
                //izmena += " <tr><td>ZIP</td><td><input type=\"number\" name=\"Zip\" id=\"zipV\" pattern=\"[0-9]{5}\" minlength=\"5\" maxlength=\"5\" value=\"" + trenutniKorisnik.Lokacija.Adresa.Zip + "\" required /></td></tr>";
                izmena += " <tr><td colspan=\"2\">Automobil</td></tr>";
                izmena += " <tr><td>Godište</td><td><input type=\"number\" name=\"Godiste\" id=\"godisteV\" value=\"" + trenutniKorisnik.Automobil.Godiste + "\" min=\"2000\" max=\"2018\" required/></td></tr>";
                izmena += " <tr><td>Registracija</td><td><input type=\"text\" name=\"Registracija\" id=\"regV\" value=\"" + trenutniKorisnik.Automobil.Registracija + "\" pattern=\"[A-Z]{2}[0-9]{3}[A-Z]{2}\" required /></td></tr>";
                izmena += " <tr><td>Broj Vozila</td><td><input type=\"number\" name=\"BrojVozila\" id=\"brV\" value=\"" + trenutniKorisnik.Automobil.BrojVozila + "\" min=\"0\" max=\"100\" required /></td></tr>";
                if (trenutniKorisnik.Automobil.TipAutomobila == 0) {
                    izmena += " <tr><td>Tip</td><td><select name=\"TipAutomobila\" id=\"tipAutoV\"><option selected>Putnički</option><option>Kombi</option></select></td></tr></table>";

                } else {
                    izmena += " <tr><td>Tip</td><td><select name=\"TipAutomobila\" id=\"tipAutoV\"><option>Putnički</option><option selected>Kombi</option></select></td></tr></table>";

                }

                $("#tabelaIzmenaV").html(izmena);

            });

            $("#izmeniV").click(function () {
                let v = document.getElementById("korisnickoime");
                let v1 = document.getElementById("lozinka1");
                let v2 = document.getElementById("ime1");
                let v3 = document.getElementById("prezime1");
                let v5 = document.getElementById("jmbg1");
                let v6 = document.getElementById("kontakt1");
                let v7 = document.getElementById("email1");
                let v8 = document.getElementById("godisteV");
                let v9 = document.getElementById("regV");
                let v10 = document.getElementById("brV");
                if (!v.checkValidity() && !v1.checkValidity() && !v2.checkValidity() && !v3.checkValidity() && !v5.checkValidity() && !v6.checkValidity() && !v7.checkValidity() && !v8.checkValidity() && !v9.checkValidity() && !v10.checkValidity()) {
                    alert("Popunite polja za registraciju!");
                } else if (!v.checkValidity() || !v1.checkValidity() || !v2.checkValidity() || !v3.checkValidity() || !v5.checkValidity() || !v6.checkValidity() || !v7.checkValidity()) {
                    let greska = "Niste dobro uneli:\n";
                    if (!v.checkValidity()) {
                        greska += "-Korisničko ime\n";
                    }
                    if (!v1.checkValidity()) {
                        greska += "-Lozinku\n";
                    }
                    if (!v2.checkValidity()) {
                        greska += "-Ime\n";
                    }
                    if (!v3.checkValidity()) {
                        greska += "-Prezime\n";
                    }

                    if (!v5.checkValidity()) {
                        greska += "-JMBG\n";
                    }
                    if (!v6.checkValidity()) {
                        greska += "-Kontakt\n";
                    }
                    if (!v7.checkValidity()) {
                        greska += "-Email\n";
                    }
                    if (!v8.checkValidity()) {
                        greska += "-Godište automobila\n";
                    }
                    if (!v9.checkValidity()) {
                        greska += "-Registracija automobila\n";
                    }
                    if (!v10.checkValidity()) {
                        greska += "-Broj taxi vozila\n";
                    }
                    alert(greska);
                } else if (lokacijaMapa=="") {
                    alert("Unesite lokaciju!");

                } else {
                    let jmbg = `${$('#jmbgVD').val()}`;
                    let danRodjenja = jmbg.substring(0, 2);
                    let mesecRodjenja = jmbg.substring(2, 4);
                    let godinaRodjenja = jmbg.substring(4, 7);
                    danRodjenja = parseInt(danRodjenja);
                    mesecRodjenja = parseInt(mesecRodjenja);
                    godinaRodjenja = parseInt(godinaRodjenja);
                    if (danRodjenja <= 0 || danRodjenja > 31 || mesecRodjenja <= 0 || mesecRodjenja > 12 || (godinaRodjenja > 18 && godinaRodjenja < 900)) {
                        alert("JMBG je neispravan!");
                    } else {
                        let lokacija2 = lokacijaMapa;
                        lokacijaMapa = "";
                        let e = document.getElementById('tipAutoV');
                        let selValue = e.options[e.selectedIndex].text;

                        let automobil = {
                            Godiste: `${$('#godisteV').val()}`,
                            Registracija: `${$('#regV').val()}`,
                            BrojVozila: `${$('#brV').val()}`,
                            TipAutomobila: selValue,
                        };

                        let korisnik = {
                            Id: trenutniKorisnik.Id,
                            KorisnickoIme: `${$('#korisnickoime').val()}`,
                            Lozinka: `${$('#lozinka1').val()}`,
                            Ime: `${$('#ime1').val()}`,
                            Prezime: `${$('#prezime1').val()}`,
                            Pol: trenutniKorisnik.Pol,
                            JMBG: `${$('#jmbg1').val()}`,
                            Kontakt: `${$('#kontakt1').val()}`,
                            Email: `${$('#email1').val()}`,
                            Voznje: trenutniKorisnik.Voznje,
                            Uloga: trenutniKorisnik.Uloga,
                            Lokacija: lokacija2,
                            Automobil: automobil,
                        };

                        $.ajax({
                            type: 'PUT',
                            url: '/api/Vozac/' + trenutniKorisnik.Id,
                            data: JSON.stringify(korisnik),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data) {
                                    alert("Uspešno ste izmenili podatke.");
                                    localStorage.setItem("ulogovani", korisnik.KorisnickoIme);
                                    $(location).attr('href', 'Korisnik.html');
                                }
                                else {
                                    alert("Polja nisu dobro popunjena ili je korisničko ime zauzeto!");
                                }
                            },
                            error: function (errorData) {

                            }
                        })
                    }
                }
            });

            $("#refreshV1").click(function () {


                $("#pretragaV1").css("display", "inline");
                document.getElementById('cenaOdV1').value = '';
                document.getElementById('cenaDoV1').value = '';
                document.getElementById('ocenaPretragaOdV1').selectedIndex = 0;
                document.getElementById('ocenaPretragaDoV1').selectedIndex = 0;
                document.getElementById('statusPretragaV1').selectedIndex = 0;
                document.getElementById('DatumOdV1').value = '';
                document.getElementById('DatumDoV1').value = '';

                $("#pretraziV1").click();
            });

            $("#refreshV2").click(function () {

                document.getElementById('DatumOdV2').value = '';
                document.getElementById('DatumDoV2').value = '';
                $("#pretragaV2").css("display", "inline");
                $("#pretraziV2").click();
            });

            $("#pretraziV1").click(function () {
                $("#LondonV").html("");
                $("#pretragaV2").css("display", "none");
                let id = localStorage.getItem("ulogovaniId");

                let e = document.getElementById('statusPretragaV1');
                let selValue = e.options[e.selectedIndex].value;
                let statusPretrage = selValue;

                let datumOd = `${$('#DatumOdV1').val()}`;
                if (datumOd == "") {
                    var date = new Date("2018-01-01");
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumOd = date.getFullYear() + "-" + month + "-" + day;

                }

                let datumDo = `${$('#DatumDoV1').val()}`;
                if (datumDo == "") {
                    var date = new Date();
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumDo = date.getFullYear() + "-" + month + "-" + day;
                }

                let e1 = document.getElementById('ocenaPretragaOdV1');
                let selValue1 = e1.options[e1.selectedIndex].value;
                let ocenaOd = selValue1;

                let e2 = document.getElementById('ocenaPretragaDoV1');
                let selValue2 = e2.options[e2.selectedIndex].value;
                let ocenaDo = selValue2;

                let cenaOd = `${$('#cenaOdV1').val()}`;
                if (cenaOd == "") {
                    cenaOd = 0;
                }

                let cenaDo = `${$('#cenaDoV1').val()}`;
                if (cenaDo == "") {
                    cenaDo = 9999;
                }

                let e3 = document.getElementById('SortV1');
                let selValue3 = e3.options[e3.selectedIndex].value;
                let sort = selValue3;

                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac/' + id,
                    async: false,
                    success: function (data) {
                        localStorage.setItem("ulogovaniStatus", data.Zauzet);
                    }
                })

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    async: false,
                    success: function (data) {



                        let ulogovani = localStorage.getItem("ulogovani");
                        let tableOfProducts = "<table class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\" id=\"mojeV\"><tr><td>Datum</td><td>Početna lokacija</td><td>Odredište</td> <td colspan=\"2\">Dispečer</td> <td colspan=\"2\">Mušterija</td> <td>Iznos</td><td>Ocena</td> <td>Status</td> <td>Komentar</td><td></td></tr>";
                        for (voznja in data) {
                            if (data[voznja].Vozac == id) {

                                var date = new Date(data[voznja].Datum);
                                var month = date.getMonth() + 1;
                                var day = date.getDate();
                                var hours = date.getHours();
                                var minutes = date.getMinutes();

                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hours < 10) hours = '0' + hours;
                                if (minutes < 10) minutes = '0' + minutes;

                                var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;
                                var date2 = date.getFullYear() + "-" + month + "-" + day;

                                let dispIme = "";
                                let dispPrezime = "";

                                if (data[voznja].Dispecer != -1) {
                                    $.get("/api/Dispecer/" + data[voznja].Dispecer, function (disp, status) {
                                        dispIme = disp.Ime;
                                        dispPrezime = disp.Prezime;
                                    });
                                }
                                let korIme = "";
                                let korPrezime = "";

                                if (data[voznja].Musterija != -1) {
                                    $.get("/api/Korisnik/" + data[voznja].Musterija, function (kor, status) {
                                        korIme = kor.Ime;
                                        korPrezime = kor.Prezime;
                                    });
                                }


                                if ((data[voznja].Status == statusPretrage || statusPretrage == -1) && (date2 >= datumOd && date2 <= datumDo) && (data[voznja].Iznos >= cenaOd && data[voznja].Iznos <= cenaDo) && (data[voznja].Komentar.Ocena >= ocenaOd && data[voznja].Komentar.Ocena <= ocenaDo)) {
                                    tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/>  ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${data[voznja].Odrediste.Adresa.Ulica} <br/>  ${data[voznja].Odrediste.Adresa.Mesto}</td><td>${korIme}</td><td>${korPrezime}</td><td>${dispIme}</td><td>${dispPrezime}</td><td>${data[voznja].Iznos}</td><td>${data[voznja].Komentar.Ocena}</td>`;


                                    switch (data[voznja].Status) {
                                        case 0:
                                            tableOfProducts += `<td>Kreirana-Na čekanju</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            break;
                                        case 1:
                                            tableOfProducts += `<td>Formirana</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            tableOfProducts += `<td><button id="uspesna${data[voznja].Id}" type="button" onclick="uspesnaClickV(${data[voznja].Id});">Uspešna</button>`;
                                            tableOfProducts += ` <button id="neuspesna${data[voznja].Id}" type="button" onclick="neuspesnaClickV(${data[voznja].Id});">Neuspešna</button></td>`;

                                            break;
                                        case 2:
                                            tableOfProducts += `<td>Obrađena</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            tableOfProducts += `<td><button id="uspesna${data[voznja].Id}" type="button" onclick="uspesnaClickV(${data[voznja].Id});">Uspešna</button>`;
                                            tableOfProducts += ` <button id="neuspesna${data[voznja].Id}" type="button" onclick="neuspesnaClickV(${data[voznja].Id});">Neuspešna</button></td>`;

                                            break;
                                        case 3:
                                            tableOfProducts += `<td>Prihvaćena</td>`;
                                            tableOfProducts += `<td>Nema komentara</td>`;
                                            tableOfProducts += `<td><button id="uspesna${data[voznja].Id}" type="button" onclick="uspesnaClickV(${data[voznja].Id});">Uspešna</button>`;
                                            tableOfProducts += ` <button id="neuspesna${data[voznja].Id}" type="button" onclick="neuspesnaClickV(${data[voznja].Id});">Neuspešna</button></td>`;

                                            break;
                                        case 4:
                                            tableOfProducts += `<td>Otkazana</td>`;
                                            tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickV(${data[voznja].Id});">Vidi komentar</button></td>`;

                                            break;
                                        case 5:
                                            tableOfProducts += `<td>Uspešna</td>`;
                                            if (data[voznja].Komentar.Korisnik == -1) {
                                                tableOfProducts += `<td><button id="dodajKomentar${data[voznja].Id}" type="button" onclick="dodajKomentarClickV(${data[voznja].Id});">Dodaj komentar</button></td>`;

                                            } else {
                                                tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickV(${data[voznja].Id});">Vidi komentar</button></td>`;

                                            }
                                            break;
                                        case 6:
                                            tableOfProducts += `<td>Neuspešna</td>`;
                                            tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickV(${data[voznja].Id});">Vidi komentar</button></td>`;

                                            break;

                                    }
                                }

                            }
                        }
                        tableOfProducts += "</table>";
                        $("#LondonV").append(tableOfProducts);
                    }
                });


                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                document.getElementById("LondonV").style.display = "block";
                event.currentTarget.className += " active";

            });

            $("#pretraziV2").click(function () {
                $("#TokyoV").html("");
                $("#pretragaV1").css("display", "none");

                let id = localStorage.getItem("ulogovaniId");


                let datumOd = `${$('#DatumOdV2').val()}`;
                if (datumOd == "") {
                    var date = new Date("2018-01-01");
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumOd = date.getFullYear() + "-" + month + "-" + day;

                }

                let datumDo = `${$('#DatumDoV2').val()}`;
                if (datumDo == "") {
                    var date = new Date();
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    datumDo = date.getFullYear() + "-" + month + "-" + day;
                }



                let e3 = document.getElementById('SortV2');
                let selValue3 = e3.options[e3.selectedIndex].value;
                let sort = selValue3;

                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac/' + id,
                    async: false,
                    success: function (data) {
                        localStorage.setItem("ulogovaniStatus", data.Zauzet);
                    }
                })

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    async: false,
                    success: function (data) {

                        let tip = localStorage.getItem("ulogovaniTip");
                        let status2 = localStorage.getItem("ulogovaniStatus");
                        let tableOfProducts = "<table class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\" id=\"kreiraneV\"><tr><td>Datum</td><td>Početna lokacija</td><td colspan=\"2\">Mušterija</td><td>Tip Automobila</td></tr>";
                        for (voznja in data) {
                            if (data[voznja].Status == 0 && (data[voznja].TipAutomobila == tip || data[voznja].TipAutomobila == 0)) {


                                var date = new Date(data[voznja].Datum);
                                var month = date.getMonth() + 1;
                                var day = date.getDate();
                                var hours = date.getHours();
                                var minutes = date.getMinutes();

                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hours < 10) hours = '0' + hours;
                                if (minutes < 10) minutes = '0' + minutes;

                                var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;
                                var date2 = date.getFullYear() + "-" + month + "-" + day;

                                if (date2 >= datumOd && date2 <= datumDo) {
                                    let korIme = "";
                                    let korPrezime = "";

                                    if (data[voznja].Musterija != -1) {
                                        $.get("/api/Korisnik/" + data[voznja].Musterija, function (kor, status) {
                                            korIme = kor.Ime;
                                            korPrezime = kor.Prezime;
                                        });
                                    }

                                    tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/>  ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${korIme}</td><td>${korPrezime}</td>`;
                                    if (data[voznja].TipAutomobila == 0) {
                                        tableOfProducts += `<td>Svejedno</td>`;
                                    } else if (data[voznja].TipAutomobila == 1) {
                                        tableOfProducts += `<td>Putnički</td>`;
                                    } else if (data[voznja].TipAutomobila == 2) {
                                        tableOfProducts += `<td>Kombi</td>`;
                                    }

                                    if (status2 == "true") {
                                        tableOfProducts += `<td><button id="preuzmi${data[voznja].Id}" type="button" onclick="preuzmiVoznjuClick(${data[voznja].Id});" disabled>Preuzmi Vožnju</button></td>`;

                                    } else {
                                        tableOfProducts += `<td><button id="preuzmi${data[voznja].Id}" type="button" onclick="preuzmiVoznjuClick(${data[voznja].Id});">Preuzmi Vožnju</button></td>`;

                                    }

                                }

                            }
                        }
                        tableOfProducts += "</table>";
                        $("#TokyoV").append(tableOfProducts);
                    }
                });


                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                document.getElementById("TokyoV").style.display = "block";
                event.currentTarget.className += " active";

            });

        });

        //Musterija
        function izmeniVoznjuClick(id) {
            $("#mapa").css("display", "inline");
            $("#pretragaK").css("display", "none");
            $("#tabelaMojeVoznjeK").css("display", "none");
            $("#izmenaVoznjeK").html("");

            $.ajax({
                type: 'GET',
                url: '/api/Voznja/' + id,
                async: false,
                success: function (data) {


                    localStorage.setItem("voznjaZaIzmenu", data.Id);


                    let izmena = "<table border=\"1\">";
                    //izmena += "<tr><td colspan=\"2\">Vaša lokacija</td></tr > ";
                    //izmena += "<tr><td>X</td><td><input type=\"number\" name=\"X\" id=\"xI\" value = \"" + data.PocetnaLokacija.X + "\" required /></td></tr>";
                    //izmena += "<tr><td>Y</td><td><input type=\"number\" name=\"Y\" id=\"yI\" value = \"" + data.PocetnaLokacija.Y + "\" required /></td></tr>";
                    //izmena += "<tr><td colspan=\"2\">Adresa</td></tr>";
                    //izmena += "<tr><td>Ulica</td><td><input type=\"text\" name=\"Ulica\" id=\"ulicaI\" value = \" " + data.PocetnaLokacija.Adresa.Ulica + "\" required /></td></tr>";
                    //izmena += "<tr><td>Broj</td><td><input type=\"text\" name=\"Broj\" id=\"brojI\" value = \" " + data.PocetnaLokacija.Adresa.Broj + "\" required /></td></tr>";
                    //izmena += "<tr><td>Mesto</td><td><input type=\"text\" name=\"Mesto\" id=\"mestoI\" value = \" " + data.PocetnaLokacija.Adresa.Mesto + "\" required /></td></tr>";
                    //izmena += "<tr><td>Zip</td><td><input type=\"number\" name=\"Zip\" id=\"zipI\" value=\"" + data.PocetnaLokacija.Adresa.Zip + "\" required/></td></tr>";

                    if (data.TipAutomobila == 0) {
                        izmena += "<tr><td>Tip Automobila</td><td><select name=\"Auto\" id=\"autoI\"><option selected>Svejedno</option><option>Putnički</option><option>Kombi</option></select></td></tr>";

                    } else if (data.TipAutomobila == 1) {
                        izmena += "<tr><td>Tip Automobila</td><td><select name=\"Auto\" id=\"autoI\"><option>Svejedno</option><option selected>Putnički</option><option>Kombi</option></select></td></tr>";

                    } else {
                        izmena += "<tr><td>Tip Automobila</td><td><select name=\"Auto\" id=\"autoI\"><option>Svejedno</option><option selected>Putnički</option><option selected>Kombi</option></select></td></tr>";

                    }
                    izmena += "<tr><td colspan=\"2\"><button id=\"izmeniVoznju\" type=\"button\" onclick=\"izmeniVoznjuKlik();\">Izmeni Voznju</button></td></tr></table>";


                    $("#izmenaVoznjeK").append(izmena);
                }
            });
            $("#izmenaVoznjeK").css("display", "inline");
        }

        function sortTableK() {
            var n = document.getElementById("SortK").value;
            if (n == 1) {
                n = 8;
            }
            var table, rows, switching, i, x, y, shouldSwitch;
            table = document.getElementById("musterijaVoznje");
            switching = true;

            while (switching) {

                switching = false;
                rows = table.getElementsByTagName("TR");

                for (i = 2; i < (rows.length - 1); i++) {

                    shouldSwitch = false;

                    x = rows[i].getElementsByTagName("TD")[n];
                    y = rows[i + 1].getElementsByTagName("TD")[n];

                    if (n == 8) {
                        if (Number(x.innerHTML) < Number(y.innerHTML)) {

                            shouldSwitch = true;
                            break;
                        }
                    } else {
                        if (new Date(x.innerHTML) < new Date(y.innerHTML)) {

                            shouldSwitch = true;
                            break;
                        }
                    }
                }
                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                }
            }
        }

        function vidiKomentarClick(id) {
            $("#dodajKomentarK").css("display", "none");

            $.ajax({
                type: 'GET',
                url: '/api/Voznja/' + id,
                async: false,
                success: function (data) {

                    var date = new Date(data.Komentar.DatumObjave);
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    var datum = date.getFullYear() + "-" + month + "-" + day;
                    $("#opisP").text(data.Komentar.Opis);
                    $("#datumP").text(datum);

                    if (data.Komentar.KorisnikUloga == 0) {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Korisnik/' + data.Komentar.Korisnik,
                            async: false,
                            success: function (v) {
                                $("#korisnikP").text(v.Ime + " " + v.Prezime + "[Mušterija]");
                            }
                        })
                    } else if (data.Komentar.KorisnikUloga == 1) {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Dispecer/' + data.Komentar.Korisnik,
                            async: false,
                            success: function (v) {
                                $("#korisnikP").text(v.Ime + " " + v.Prezime + "[Dispečer]");
                            }
                        })
                    } else {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Vozac/' + data.Komentar.Korisnik,
                            async: false,
                            success: function (v) {
                                $("#korisnikP").text(v.Ime + " " + v.Prezime + "[Vozač]");
                            }
                        })
                    }

                    $("#OcenaP").text(data.Komentar.Ocena);

                }
            });

            $("#prikaziKomentarK").css("display", "inline");

        }

        function zatvoriKomentarK() {

            $("#prikaziKomentarK").css("display", "none");
        }

        function otkaziKomentarDugmeK() {
            $("#dodajKomentarK").css("display", "none");
        }

        function izmeniVoznjuKlik() {


            let IdIzmene = localStorage.getItem("voznjaZaIzmenu");

            //let adresa = {
            //    Ulica: `${$('#ulicaI').val()}`,
            //    Broj: `${$('#brojI').val()}`,
            //    Mesto: `${$('#mestoI').val()}`,
            //    Zip: `${$('#zipI').val()}`,
            //};
            //let lokacija = {
            //    X: `${$('#xI').val()}`,
            //    Y: `${$('#yI').val()}`,
            //    Adresa: adresa,
            //};
            let lokacija2 = lokacijaMapa;
            if (lokacija2 == "") {
                alert("Izaberite lokaciju!");
            } else {
                lokacijaMapa = "";
                let e = document.getElementById('autoI');
                let selValue = e.options[e.selectedIndex].text;

                let Voznja = {

                    PocetnaLokacija: lokacija2,
                    TipAutomobila: selValue,
                    Status: "Kreirana",

                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Voznja/' + IdIzmene,
                    data: JSON.stringify(Voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert("Uspešno ste izmenili vožnju.");
                            $("#homeK").click();

                        }
                        else {
                            alert("neuspešna izmena!");
                        }
                    },
                    error: function (errorData) {

                    }
                })
                $("#izmenaVoznjeK").css("display", "none");
            }
        }

        function otkaziVoznjuClick(id) {
            $("#dodajKomentarOtkaziK").css("display", "inline");
            localStorage.setItem("otkazanaVoznja", id);
            localStorage.setItem("zabrana", "1");
            
        }

        function dodajKomentarOtkaziDugmeK() {
            let v = document.getElementById("opisKO");
            let v1 = document.getElementById("ocenaKO");
            if (!v.checkValidity() && !v1.checkValidity()) {
                alert("Popunite polja komentara!");
            } else if (!v.checkValidity() || !v1.checkValidity()){
                let greska = "Niste dobro uneli:\n";
                if (!v.checkValidity()) {
                    greska += "-Opis\n";
                }
                if (!v1.checkValidity()) {
                    greska += "-Ocenu\n";
                }
                alert(greska);
            } else {
                let v = localStorage.getItem("otkazanaVoznja");
                let ulogovani = localStorage.getItem("ulogovaniId");

                let komentar = {

                    Opis: `${$('#opisKO').val()}`,
                    Korisnik: ulogovani,
                    KorisnikUloga: "Mušterija",
                    Voznja: v,
                    Ocena: `${$('#ocenaKO').val()}`,

                };

                let Voznja = {
                    Id: v,
                    Komentar: komentar,
                    Status: "Otkazana",
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Voznja/' + v,
                    data: JSON.stringify(Voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            $("#dodajKomentarOtkaziK").css("display", "none");
                            localStorage.setItem("zabrana", "0");
                            $("#homeK").click();

                        }
                        else {
                            alert("neuspešna izmena vožnje!");
                        }
                    },
                    error: function (errorData) {

                    }
                })
            }

        }

        function dodajKomentarClick(id) {
            $("#dodajKomentarK").css("display", "inline");
            $("#prikaziKomentarK").css("display", "none");
            localStorage.setItem("voznja", id);
        }

        function dodajKomentarDugmeK() {
            let v = document.getElementById("opisK");
            let v1 = document.getElementById("ocenaK");
            if (!v.checkValidity() && !v1.checkValidity()) {
                alert("Popunite polja komentara!");
            } else if (!v.checkValidity() || !v1.checkValidity()) {
                let greska = "Niste dobro uneli:\n";
                if (!v.checkValidity()) {
                    greska += "-Opis\n";
                }
                if (!v1.checkValidity()) {
                    greska += "-Ocenu\n";
                }
                alert(greska);
            } else {
                let v = localStorage.getItem("voznja");

                let ulogovani = localStorage.getItem("ulogovaniId");

                let komentar = {

                    Opis: `${$('#opisK').val()}`,
                    Korisnik: ulogovani,
                    KorisnikUloga: "Mušterija",
                    Voznja: v,
                    Ocena: `${$('#ocenaK').val()}`,

                };

                let Voznja = {
                    Id: v,
                    Komentar: komentar,
                    Status: "Uspešna",
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Voznja/' + v,
                    data: JSON.stringify(Voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            
                            $("#dodajKomentarK").css("display", "none");
                            $("#homeK").click();

                        }
                        else {
                            alert("neuspešno dodavanje komentara!");
                        }
                    },
                    error: function (errorData) {

                    }
                })
            }

        }


        //Dispecer
        function openCity(evt, cityName) {
            $("#London").html("");
            $("#Paris").html("");
            $("#Tokyo").html("");
            $("#pretragaD1").css("display", "none");
            $("#pretragaD2").css("display", "none");
            $("#pretragaD3").css("display", "none");
            zatvoriObraduD();
            zatvoriKomentarD();


            $.ajax({
                type: 'GET',
                url: '/api/Voznja',
                async: false,
                success: function (data) {

                    if (cityName == "London") {
                        $("#pretragaD1").css("display", "inline");
                        let ulogovani = localStorage.getItem("ulogovaniId");
                        let tableOfProducts = "<table class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\"><tr><td>Datum</td><td>Početna lokacija</td><td>Odredište</td><td colspan=\"2\">Vozač</td><td colspan=\"2\">Mušterija</td><td>Iznos</td><td>Ocena</td> <td>Status</td> <td>Komentar</td></tr>";
                        for (voznja in data) {
                            if (data[voznja].Dispecer == ulogovani) {
                                var date = new Date(data[voznja].Datum);
                                var month = date.getMonth() + 1;
                                var day = date.getDate();
                                var hours = date.getHours();
                                var minutes = date.getMinutes();

                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hours < 10) hours = '0' + hours;
                                if (minutes < 10) minutes = '0' + minutes;

                                var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;
                                var date2 = date.getFullYear() + "-" + month + "-" + day;

                                let vozacIme = "";
                                let vozacPrezime = "";

                                if (data[voznja].Vozac != -1) {
                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Vozac/' + data[voznja].Vozac,
                                        async: false,
                                        success: function (v) {
                                            vozacIme = v.Ime;
                                            vozacPrezime = v.Prezime;
                                        }
                                    })
                                }

                                let korIme = "";
                                let korPrezime = "";

                                if (data[voznja].Musterija != -1) {
                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Korisnik/' + data[voznja].Musterija,
                                        async: false,
                                        success: function (v) {
                                            korIme = v.Ime;
                                            korPrezime = v.Prezime;
                                        }
                                    })
                                }


                                tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/>  ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${data[voznja].Odrediste.Adresa.Ulica} <br/>  ${data[voznja].Odrediste.Adresa.Mesto}</td><td>${vozacIme}</td><td>${vozacPrezime}</td><td>${korIme}</td><td>${korPrezime}</td><td>${data[voznja].Iznos}</td><td>${data[voznja].Komentar.Ocena}</td>`;


                                switch (data[voznja].Status) {
                                    case 0:
                                        tableOfProducts += `<td>Kreirana-Na čekanju</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 1:
                                        tableOfProducts += `<td>Formirana</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 2:
                                        tableOfProducts += `<td>Obrađena</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 3:
                                        tableOfProducts += `<td>Prihvaćena</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 4:
                                        tableOfProducts += `<td>Otkazana</td>`;
                                        tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                        break;
                                    case 5:
                                        tableOfProducts += `<td>Uspešna</td>`;
                                        if (data[voznja].Komentar.Korisnik == -1) {
                                            tableOfProducts += `<td><button id="dodajKomentar${data[voznja].Id}" type="button" onclick="dodajKomentarClickD(${data[voznja].Id});">Dodaj komentar</button></td>`;

                                        } else {
                                            tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                        }
                                        break;
                                    case 6:
                                        tableOfProducts += `<td>Neuspešna</td>`;
                                        tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                        break;

                                }

                            }
                        }
                        tableOfProducts += "</table>";
                        $("#London").append(tableOfProducts);
                    }
                    else if (cityName == "Paris") {
                        $("#pretragaD2").css("display", "inline");
                        let tableOfProducts = "<table class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\"><tr><td>Datum</td> <td>Početna lokacija</td> <td>Odredište</td> <td colspan=\"2\">Vozač</td><td colspan=\"2\">Mušterija</td> <td colspan=\"2\">Dispečer</td> <td>Iznos</td><td>Ocena</td> <td>Status</td> <td>Komentar</td></tr>";
                        for (voznja in data) {
                            var date = new Date(data[voznja].Datum);
                            var month = date.getMonth() + 1;
                            var day = date.getDate();
                            var hours = date.getHours();
                            var minutes = date.getMinutes();

                            if (month < 10) month = '0' + month;
                            if (day < 10) day = '0' + day;
                            if (hours < 10) hours = '0' + hours;
                            if (minutes < 10) minutes = '0' + minutes;

                            var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;
                            var date2 = date.getFullYear() + "-" + month + "-" + day;

                            let vozacIme = "";
                            let vozacPrezime = "";

                            if (data[voznja].Vozac != -1) {
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Vozac/' + data[voznja].Vozac,
                                    async: false,
                                    success: function (v) {
                                        vozacIme = v.Ime;
                                        vozacPrezime = v.Prezime;
                                    }
                                })
                            }

                            let dispIme = "";
                            let dispPrezime = "";

                            if (data[voznja].Dispecer != -1) {
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Dispecer/' + data[voznja].Dispecer,
                                    async: false,
                                    success: function (v) {
                                        dispIme = v.Ime;
                                        dispPrezime = v.Prezime;
                                    }
                                })
                            }
                            let korIme = "";
                            let korPrezime = "";

                            if (data[voznja].Musterija != -1) {
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Korisnik/' + data[voznja].Musterija,
                                    async: false,
                                    success: function (v) {
                                        korIme = v.Ime;
                                        korPrezime = v.Prezime;
                                    }
                                })
                            }


                            tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/>  ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${data[voznja].Odrediste.Adresa.Ulica} <br/>  ${data[voznja].Odrediste.Adresa.Mesto}</td><td>${vozacIme}</td><td>${vozacPrezime}</td><td>${korIme}</td><td>${korPrezime}</td><td>${dispIme}</td><td>${dispPrezime}</td><td>${data[voznja].Iznos}</td><td>${data[voznja].Komentar.Ocena}</td>`;

                            switch (data[voznja].Status) {
                                case 0:
                                    tableOfProducts += `<td>Kreirana-Na čekanju</td>`;
                                    tableOfProducts += `<td>Nema komentara</td>`;
                                    break;
                                case 1:
                                    tableOfProducts += `<td>Formirana</td>`;
                                    tableOfProducts += `<td>Nema komentara</td>`;
                                    break;
                                case 2:
                                    tableOfProducts += `<td>Obrađena</td>`;
                                    tableOfProducts += `<td>Nema komentara</td>`;
                                    break;
                                case 3:
                                    tableOfProducts += `<td>Prihvaćena</td>`;
                                    tableOfProducts += `<td>Nema komentara</td>`;
                                    break;
                                case 4:
                                    tableOfProducts += `<td>Otkazana</td>`;
                                    tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                    break;
                                case 5:
                                    tableOfProducts += `<td>Uspešna</td>`;
                                    if (data[voznja].Komentar.Korisnik == -1) {
                                        tableOfProducts += `<td><button id="dodajKomentar${data[voznja].Id}" type="button" onclick="dodajKomentarClickD(${data[voznja].Id});">Dodaj komentar</button></td>`;

                                    } else {
                                        tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                    }
                                    break;
                                case 6:
                                    tableOfProducts += `<td>Neuspešna</td>`;
                                    tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickD(${data[voznja].Id});">Vidi komentar</button></td>`;

                                    break;

                            }

                        }
                        tableOfProducts += "</table>";
                        $("#Paris").append(tableOfProducts);
                    }
                    else if (cityName == "Tokyo") {
                        $("#pretragaD3").css("display", "inline");
                        let tableOfProducts = "<table class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\"><tr><td>Datum</td> <td>Početna lokacija</td> <td colspan=\"2\">Mušterija</td> <td>Tip Automobila</td></tr>";
                        for (voznja in data) {
                            if (data[voznja].Status == 0) {
                                var date = new Date(data[voznja].Datum);
                                var month = date.getMonth() + 1;
                                var day = date.getDate();
                                var hours = date.getHours();
                                var minutes = date.getMinutes();

                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hours < 10) hours = '0' + hours;
                                if (minutes < 10) minutes = '0' + minutes;

                                var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;
                                var date2 = date.getFullYear() + "-" + month + "-" + day;

                                let korIme = "";
                                let korPrezime = "";

                                if (data[voznja].Musterija != -1) {
                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Korisnik/' + data[voznja].Musterija,
                                        async: false,
                                        success: function (v) {
                                            korIme = v.Ime;
                                            korPrezime = v.Prezime;
                                        }
                                    })
                                }

                                tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/>  ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${korIme}</td><td>${korPrezime}</td>`;
                                if (data[voznja].TipAutomobila == 0) {
                                    tableOfProducts += `<td>Svejedno</td>`;
                                } else if (data[voznja].TipAutomobila == 1) {
                                    tableOfProducts += `<td>Putnički</td>`;
                                } else if (data[voznja].TipAutomobila == 2) {
                                    tableOfProducts += `<td>Kombi</td>`;
                                }

                                tableOfProducts += `<td><button id="obradi${data[voznja].Id}" type="button" onclick="obradiVoznjuClick(${data[voznja].Id});">Obradi Vožnju</button></td>`;

                            }
                        }
                        tableOfProducts += "</table>";
                        $("#Tokyo").append(tableOfProducts);

                    }
                }
            });


            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        function obradiVoznjuClick(id) {
            let voznja = "";
            $("#obradaVoznjeD").html("");
            $.ajax({
                type: 'GET',
                url: '/api/Voznja/' + id,
                async: false,
                success: function (data) {
                    voznja = data;
                }
            });
            var listaRastojanja = [];
           // let rastojanje = Math.sqrt(Math.pow((voznja.PocetnaLokacija.X - data[vozac].Lokacija.X), 2) + Math.pow((voznja.PocetnaLokacija.Y - data[vozac].Lokacija.Y), 2));
            $.ajax({
                type: 'GET',
                url: '/api/Vozac',
                async: false,
                success: function (data) {
                    let tipBr = voznja.TipAutomobila;
                    let listaPet = [];
                    let listCount = 0;
                   // let c = data.count;
                    if (Object.keys(data).length > 5) {
                        for (vozac in data) {
                            if ((data[vozac].Automobil.TipAutomobila == tipBr || tipBr == 0)&& data[vozac].Zauzet == false) {
                                var singleObj = {}
                                singleObj['Id'] = data[vozac].Id;
                                let rastojanje = Math.sqrt(Math.pow((voznja.PocetnaLokacija.X - data[vozac].Lokacija.X), 2) + Math.pow((voznja.PocetnaLokacija.Y - data[vozac].Lokacija.Y), 2));
                                singleObj['D'] = rastojanje;
                                listaRastojanja.push(singleObj);
                                listCount++;
                            }
                        }
                        //listaRastojanja.sort(function (a, b) { return a - b });
                        listaRastojanja.sort(function (a, b) { return (a.D > b.D) ? 1 : ((b.D > a.D) ? -1 : 0); });
                        

                        for (let i = 0; i < listCount; i++) {
                            listaPet.push(listaRastojanja[i].Id);
                            if (i == 4) {
                                break;
                            }
                        }
                    }
                    

                    let tabela = `<table><tr><td>Vozač</td><td><select name="Vozac" id="vozacO">`;
                    let brojac = 0;
                    let jes = true;
                    for (vozac in data) {
                        if (Object.keys(data).length > 5) {
                           jes = listaPet.includes(data[vozac].Id);
                        } 
                        
                        if (data[vozac].Zauzet == false && jes == true) {
                            if (tipBr == 0) {
                                tabela += `<option value=\"${data[vozac].Id}\">` + data[vozac].Ime + " " + data[vozac].Prezime + `</option>`;
                                brojac++;
                            } else if (data[vozac].Automobil.TipAutomobila == tipBr) {
                                tabela += `<option value=\"${data[vozac].Id}\">` + data[vozac].Ime + " " + data[vozac].Prezime + `</option>`;
                                brojac++;
                            }

                        }
                    }

                    tabela += `</select></td></tr><tr><td><button id="obradiVoznju2D" onclick="obradiDugmeD(${voznja.Id});" type="button">Dodeli</button></td><td><button onclick="zatvoriObraduD();" type="button">Otkaži</button></td></tr></table>`;
                    if (brojac == 0) {
                        alert("ne postoji slobodan vozač, vožnja ostaje na čekanju!");
                        $("#obradaVoznjeD").html("");
                        $("#obradaVoznjeD").css("display", "none");
                        $(location).attr('href', 'Korisnik.html');
                    }
                    $("#obradaVoznjeD").append(tabela);
                }
            });

            $("#obradaVoznjeD").css("display", "inline");
        }

        function zatvoriObraduD() {

            $("#obradaVoznjeD").css("display", "none");
        }

        function obradiDugmeD(id) {
            let e = document.getElementById('vozacO');
            let selValue = e.options[e.selectedIndex].value;
            let value = selValue;

            let disp = localStorage.getItem("ulogovaniId");
            let dispecer = "";
            $.ajax({
                type: 'GET',
                url: '/api/Dispecer/' + disp,
                async: false,
                success: function (data) {

                    localStorage.setItem("dispecer", data.KorisnickoIme);
                }
            });

            dispecer = localStorage.getItem("dispecer");
            let voznja = {
                Vozac: value,
                Dispecer: disp,
                Status: "Obrađena",
            }

            $.ajax({
                type: 'PUT',
                url: '/api/Voznja/' + id,
                data: JSON.stringify(voznja),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data) {
                        
                        $("#homeD").click();

                    }
                    else {
                        alert("neuspešna obrada vožnje!");
                    }
                },
                error: function (errorData) {

                }
            })
            $("#obradaVoznjeD").css("display", "none");
        }

        function blokirajVozaca(id) {
            let vozac = "";
            $.ajax({
                type: 'GET',
                url: '/api/Vozac/' + id,
                async: false,
                success: function (v) {
                    vozac = v;
                }
            })

            vozac.Blokiran = true;

            $.ajax({
                type: 'PUT',
                url: '/api/Vozac/' + id,
                data: JSON.stringify(vozac),
                headers: {
                    "ulogovani": localStorage.getItem("ulogovani").toString
                },
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data) {
                        alert("blokiran vozač " + vozac.Ime + " " + vozac.Prezime + "!");
                        $(location).attr('href', 'Korisnik.html');
                    } else {
                        alert("Vozač nije blokiran!");
                    }
                },
                error: function (errorData) {

                }
            })
        }

        function odblokirajVozaca(id) {
            let vozac = "";
            $.ajax({
                type: 'GET',
                url: '/api/Vozac/' + id,
                async: false,
                success: function (v) {
                    vozac = v;
                }
            })

            vozac.Blokiran = false;

            $.ajax({
                type: 'PUT',
                url: '/api/Vozac/' + id,
                data: JSON.stringify(vozac),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data) {
                        alert("odblokiran vozač " + vozac.Ime + " " + vozac.Prezime + "!");
                        $(location).attr('href', 'Korisnik.html');
                    }
                    else {
                        alert("Vozač nije odblokiran!");
                    }
                },
                error: function (errorData) {

                }
            })
        }

        function blokirajKorisnika(id) {
            let kor = "";
            $.ajax({
                type: 'GET',
                url: '/api/Korisnik/' + id,
                async: false,
                success: function (v) {
                    kor = v;
                }
            })

            kor.Blokiran = true;

            $.ajax({
                type: 'PUT',
                url: '/api/Korisnik/' + id,
                data: JSON.stringify(kor),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data) {
                        alert("blokirana mušterija " + kor.Ime + " " + kor.Prezime + "!");
                        $(location).attr('href', 'Korisnik.html');
                    }
                    else {
                        alert("Mušterija nije blokirana!");
                    }
                },
                error: function (errorData) {

                }
            })
        }

        function odblokirajKorisnika(id) {
            let kor = "";
            $.ajax({
                type: 'GET',
                url: '/api/Korisnik/' + id,
                async: false,
                success: function (v) {
                    kor = v;
                }
            })

            kor.Blokiran = false;

            $.ajax({
                type: 'PUT',
                url: '/api/Korisnik/' + id,
                data: JSON.stringify(kor),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data) {
                        alert("odblokirana mušterija " + kor.Ime + " " + kor.Prezime + "!");
                        $(location).attr('href', 'Korisnik.html');
                    }
                    else {
                        alert("Mušterija nije odblokirana!");
                    }
                },
                error: function (errorData) {

                }
            })
        }
        
        function vidiKomentarClickD(id) {
            $("#dodajKomentarD").css("display", "none");

            $.ajax({
                type: 'GET',
                url: '/api/Voznja/' + id,
                async: false,
                success: function (data) {

                    var date = new Date(data.Komentar.DatumObjave);
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    var datum = date.getFullYear() + "-" + month + "-" + day;
                    $("#opisPD").text(data.Komentar.Opis);
                    $("#datumPD").text(datum);

                    if (data.Komentar.KorisnikUloga == 0) {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Korisnik/' + data.Komentar.Korisnik,
                            async: false,
                            success: function (v) {
                                $("#korisnikPD").text(v.Ime + " " + v.Prezime + "[Mušterija]");
                            }
                        })
                    } else if (data.Komentar.KorisnikUloga == 1) {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Dispecer/' + data.Komentar.Korisnik,
                            async: false,
                            success: function (v) {
                                $("#korisnikPD").text(v.Ime + " " + v.Prezime + "[Dispečer]");
                            }
                        })
                    } else {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Vozac/' + data.Komentar.Korisnik,
                            async: false,
                            success: function (v) {
                                $("#korisnikPD").text(v.Ime + " " + v.Prezime + "[Vozač]");
                            }
                        })
                    }



                    $("#OcenaPD").text(data.Komentar.Ocena);

                }
            });

            $("#prikaziKomentarD").css("display", "inline");

        }

        function zatvoriKomentarD() {

            $("#prikaziKomentarD").css("display", "none");
        }

        function otkaziKomentarDugmeD() {

            $("#dodajKomentarD").css("display", "none");
        }
        
        function dodajKomentarClickD(id) {
            $("#dodajKomentarD").css("display", "inline");
            $("#prikaziKomentarD").css("display", "none");
            localStorage.setItem("otkazanaVoznja", id);
        }

        function dodajKomentarDugmeD() {
            let v = document.getElementById("opisD");
            let v1 = document.getElementById("ocenaD");
            if (!v.checkValidity() && !v1.checkValidity()) {
                alert("Popunite polja komentara!");
            } else if (!v.checkValidity() || !v1.checkValidity()) {
                let greska = "Niste dobro uneli:\n";
                if (!v.checkValidity()) {
                    greska += "-Opis\n";
                }
                if (!v1.checkValidity()) {
                    greska += "-Ocenu\n";
                }
                alert(greska);
            } else {
                let otkazanaVoznja = localStorage.getItem("otkazanaVoznja");
                let ulogovani = localStorage.getItem("ulogovaniId");

                let komentar = {

                    Opis: `${$('#opisD').val()}`,
                    Korisnik: ulogovani,
                    KorisnikUloga: "Dispečer",
                    Voznja: otkazanaVoznja,
                    Ocena: `${$('#ocenaD').val()}`,

                };

                let Voznja = {
                    Id: otkazanaVoznja,
                    Komentar: komentar,
                    Status: "Uspešna",
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Voznja/' + otkazanaVoznja,
                    data: JSON.stringify(Voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                           
                            $("#dodajKomentarD").css("display", "none");
                            $("#homeD").click();

                        }
                        else {
                            alert("neuspešno dodavanje komentara!");
                        }
                    },
                    error: function (errorData) {

                    }
                })
            }

        }





        //Vozac
        function uspesnaClickV(id) {
            $("#uspesnaVoznjaV").css("display", "inline");
            $("#pretragaV1").css("display", "none");
            $("#pretragaV2").css("display", "none");
            $("#tabeleV").css("display", "none");
            $("#mapa").css("display", "inline");
            localStorage.setItem("uspesnaVoznja", id);
        }
        
        function uspesnaVoznjaDugmeV() {
            let v = document.getElementById("iznosV");
            if (!v.checkValidity()) {
                alert("Niste dobro popunili iznos!");
            } else {

                let voznjaId = localStorage.getItem("uspesnaVoznja");

                //let adresa = {
                //    Ulica: `${$('#ulicaV').val()}`,
                //    Broj: `${$('#brojV').val()}`,
                //    Mesto: `${$('#mestoV').val()}`,
                //    Zip: `${$('#zipV').val()}`,
                //};
                //let lokacija = {
                //    X: `${$('#xV').val()}`,
                //    Y: `${$('#yV').val()}`,
                //    Adresa: adresa,
                //};

                let lokacija2 = lokacijaMapa;
                if (lokacija2 == "") {
                    alert("Izaberite lokaciju!");
                } else {
                    lokacijaMapa = "";
                    let Voznja = {

                        Odrediste: lokacija2,
                        Iznos: `${$('#iznosV').val()}`,
                        Status: "Uspešna",

                    };

                    $.ajax({
                        type: 'PUT',
                        url: '/api/Voznja/' + voznjaId,
                        data: JSON.stringify(Voznja),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            if (data) {
                               
                                $("#homeV").click();

                            }
                            else {
                                alert("neuspešna izmena vožnje!");
                            }
                        },
                        error: function (errorData) {

                        }
                    })
                    let vozacId = localStorage.getItem("ulogovaniId");
                    let korisnik = "";
                    $.ajax({
                        type: 'GET',
                        url: '/api/Vozac/' + vozacId,
                        async: false,
                        success: function (v) {
                            korisnik = v;
                        }
                    })

                    korisnik.Zauzet = false;
                    korisnik.Lokacija = lokacija2;

                    $.ajax({
                        type: 'PUT',
                        url: '/api/Vozac/' + vozacId,
                        data: JSON.stringify(korisnik),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            if (data) {
                               
                                localStorage.setItem("ulogovani", korisnik.KorisnickoIme);
                                $(location).attr('href', 'Korisnik.html');
                            }
                            else {
                                alert("Vozaču nije dodeljena lokacija automatski!");
                            }
                        },
                        error: function (errorData) {

                        }
                    })

                    $("#uspesnaVoznjaV").css("display", "none");
                }
            }
        }
        
        function neuspesnaClickV(id) {
            $("#dodajKomentarNeuspesnaV").css("display", "inline");
            localStorage.setItem("neuspesnaVoznja", id);
            localStorage.setItem("zabrana", "1");
        }
        
        function dodajKomentarNeuspesnaDugmeV() {
            let v = document.getElementById("opisVN");
            let v1 = document.getElementById("ocenaVN");
            if (!v.checkValidity() && !v1.checkValidity()) {
                alert("Popunite polja komentara!");
            } else if (!v.checkValidity() || !v1.checkValidity()) {
                let greska = "Niste dobro uneli:\n";
                if (!v.checkValidity()) {
                    greska += "-Opis\n";
                }
                if (!v1.checkValidity()) {
                    greska += "-Ocenu\n";
                }
                alert(greska);
            } else {

                let neuspesnaVoznja = localStorage.getItem("neuspesnaVoznja");
                let ulogovani = localStorage.getItem("ulogovaniId");
                let komentar = {

                    Opis: `${$('#opisVN').val()}`,
                    Korisnik: ulogovani,
                    KorisnikUloga: "Vozač",
                    Voznja: neuspesnaVoznja,
                    Ocena: `${$('#ocenaVN').val()}`,

                };

                let Voznja = {
                    Id: neuspesnaVoznja,
                    Komentar: komentar,
                    Status: "Neuspešna",
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Voznja/' + neuspesnaVoznja,
                    data: JSON.stringify(Voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            
                            $("#dodajKomentarNeuspesnaV").css("display", "none");
                            localStorage.setItem("zabrana","0");
                            $("#homeV").click();

                        }
                        else {
                            alert("neuspešna izmena vožnje!");
                        }
                    },
                    error: function (errorData) {

                    }
                })

            }
        }
        
        function preuzmiVoznjuClick(id) {

            let value = localStorage.getItem("ulogovaniId");
            let voznja = {
                Vozac: value,
                Status: "Prihvaćena",
            }

            $.ajax({
                type: 'PUT',
                url: '/api/Voznja/' + id,
                data: JSON.stringify(voznja),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data) {
                        alert("Vožnja preuzeta!");
                        $("#homeV").click();

                    }
                    else {
                        alert("neuspešno preuzimanje vožnje!");
                    }
                },
                error: function (errorData) {

                }
            })

        }
       
        function vidiKomentarClickV(id) {
            $("#dodajKomentarV").css("display", "none");
            $.ajax({
                type: 'GET',
                url: '/api/Voznja/' + id,
                async: false,
                success: function (data) {

                    var date = new Date(data.Komentar.DatumObjave);
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (month < 10) month = '0' + month;
                    if (day < 10) day = '0' + day;
                    var datum = date.getFullYear() + "-" + month + "-" + day;
                    $("#opisPV").text(data.Komentar.Opis);
                    $("#datumPV").text(datum);

                    if (data.Komentar.KorisnikUloga == 0) {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Korisnik/' + data.Komentar.Korisnik,
                            async: false,
                            success: function (v) {
                                $("#korisnikPV").text(v.Ime + " " + v.Prezime + "[Mušterija]");
                            }
                        })
                    } else if (data.Komentar.KorisnikUloga == 1) {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Dispecer/' + data.Komentar.Korisnik,
                            async: false,
                            success: function (v) {
                                $("#korisnikPV").text(v.Ime + " " + v.Prezime + "[Dispečer]");
                            }
                        })
                    } else {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Vozac/' + data.Komentar.Korisnik,
                            async: false,
                            success: function (v) {
                                $("#korisnikPV").text(v.Ime + " " + v.Prezime + "[Vozač]");
                            }
                        })
                    }




                    $("#OcenaPV").text(data.Komentar.Ocena);

                }
            });

            $("#prikaziKomentarV").css("display", "inline");

        }
        
        function zatvoriKomentarV() {

            $("#prikaziKomentarV").css("display", "none");
        }

        function otkaziKomentarDugmeV() {
            $("#dodajKomentarV").css("display", "none");
        }

        function dodajKomentarClickV(id) {
            $("#dodajKomentarV").css("display", "inline");
            $("#prikaziKomentarV").css("display", "none");
            localStorage.setItem("otkazanaVoznja", id);
        }

        function dodajKomentarDugmeV() {
            let v = document.getElementById("opisV");
            let v1 = document.getElementById("ocenaV");
            if (!v.checkValidity() && !v1.checkValidity()) {
                alert("Popunite polja komentara!");
            } else if (!v.checkValidity() || !v1.checkValidity()) {
                let greska = "Niste dobro uneli:\n";
                if (!v.checkValidity()) {
                    greska += "-Opis\n";
                }
                if (!v1.checkValidity()) {
                    greska += "-Ocenu\n";
                }
                alert(greska);
            } else {
                let otkazanaVoznja = localStorage.getItem("otkazanaVoznja");
                let ulogovani = localStorage.getItem("ulogovaniId");
                let komentar = {

                    Opis: `${$('#opisV').val()}`,
                    Korisnik: ulogovani,
                    KorisnikUloga: "Vozač",
                    Voznja: otkazanaVoznja,
                    Ocena: `${$('#ocenaV').val()}`,

                };

                let Voznja = {
                    Id: otkazanaVoznja,
                    Komentar: komentar,
                    Status: "Uspešna",
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Voznja/' + otkazanaVoznja,
                    data: JSON.stringify(Voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            
                            $("#dodajKomentarV").css("display", "none");
                            $("#homeV").click();

                        }
                        else {
                            alert("neuspešno dodavanje komentara!");
                        }
                    },
                    error: function (errorData) {

                    }
                })

            }
        }

        function sortTableV1() {
            var n = document.getElementById("SortV1").value;
            if (n == 1) {
                n = 8;
            }
            else if (n == 2) {
                n = 12;
            }

            if (n == 12) {
                let id = localStorage.getItem("ulogovaniId");
                let x0 = 0;
                let y0 = 0;
                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac/' + id,
                    async: false,
                    success: function (v) {
                        x0 = v.Lokacija.X;
                        y0 = v.Lokacija.Y;
                    }
                })

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    async: false,
                    success: function (data) {

                        var table, rows, switching, i, x, y, shouldSwitch;
                        table = document.getElementById("mojeV");
                        switching = true;

                        while (switching) {

                            switching = false;
                            rows = table.getElementsByTagName("TR");

                            for (i = 1; i < (rows.length - 1); i++) {

                                shouldSwitch = false;

                                x = rows[i].getElementsByTagName("TD")[n];
                                y = rows[i + 1].getElementsByTagName("TD")[n];

                                let x1 = data[Number(x.innerHTML)].PocetnaLokacija.X;
                                let y1 = data[Number(x.innerHTML)].PocetnaLokacija.Y;
                                let x2 = data[Number(y.innerHTML)].PocetnaLokacija.X;
                                let y2 = data[Number(y.innerHTML)].PocetnaLokacija.Y;

                                let r1 = Math.sqrt(Math.pow((x0 - x1), 2) + Math.pow((y0 - y1), 2));
                                let r2 = Math.sqrt(Math.pow((x0 - x2), 2) + Math.pow((y0 - y2), 2));

                                
                                    if (r1 > r2) {

                                        shouldSwitch = true;
                                        break;
                                    }
                                
                            }
                            if (shouldSwitch) {
                                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                                switching = true;
                            }
                        }
                    }
                });
            } else {
                var table, rows, switching, i, x, y, shouldSwitch;
                table = document.getElementById("mojeV");
                switching = true;

                while (switching) {

                    switching = false;
                    rows = table.getElementsByTagName("TR");

                    for (i = 1; i < (rows.length - 1); i++) {

                        shouldSwitch = false;

                        x = rows[i].getElementsByTagName("TD")[n];
                        y = rows[i + 1].getElementsByTagName("TD")[n];

                        if (n == 8) {
                            if (Number(x.innerHTML) < Number(y.innerHTML)) {

                                shouldSwitch = true;
                                break;
                            }
                        } else {
                            if (new Date(x.innerHTML) < new Date(y.innerHTML)) {

                                shouldSwitch = true;
                                break;
                            }
                        }
                    }
                    if (shouldSwitch) {
                        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                        switching = true;
                    }
                }
            }
        }

        function sortTableV2() {
            var n = document.getElementById("SortV2").value;
            if (n == 2) {
                n = 6;
            }

            if (n == 6) {
                let id = localStorage.getItem("ulogovaniId");
                let x0 = 0;
                let y0 = 0;
                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac/' + id,
                    async: false,
                    success: function (v) {
                        x0 = v.Lokacija.X;
                        y0 = v.Lokacija.Y;
                    }
                })

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    async: false,
                    success: function (data) {

                        var table, rows, switching, i, x, y, shouldSwitch;
                        table = document.getElementById("kreiraneV");
                        switching = true;

                        while (switching) {

                            switching = false;
                            rows = table.getElementsByTagName("TR");

                            for (i = 1; i < (rows.length - 1); i++) {

                                shouldSwitch = false;

                                x = rows[i].getElementsByTagName("TD")[n];
                                y = rows[i + 1].getElementsByTagName("TD")[n];

                                let x1 = data[Number(x.innerHTML)].PocetnaLokacija.X;
                                let y1 = data[Number(x.innerHTML)].PocetnaLokacija.Y;
                                let x2 = data[Number(y.innerHTML)].PocetnaLokacija.X;
                                let y2 = data[Number(y.innerHTML)].PocetnaLokacija.Y;

                                let r1 = Math.sqrt(Math.pow((x0 - x1), 2) + Math.pow((y0 - y1), 2));
                                let r2 = Math.sqrt(Math.pow((x0 - x2), 2) + Math.pow((y0 - y2), 2));


                                if (r1 > r2) {

                                    shouldSwitch = true;
                                    break;
                                }

                            }
                            if (shouldSwitch) {
                                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                                switching = true;
                            }
                        }
                    }
                });
            } else {

                var table, rows, switching, i, x, y, shouldSwitch;
                table = document.getElementById("kreiraneV");
                switching = true;

                while (switching) {

                    switching = false;
                    rows = table.getElementsByTagName("TR");

                    for (i = 1; i < (rows.length - 1); i++) {

                        shouldSwitch = false;

                        x = rows[i].getElementsByTagName("TD")[0];
                        y = rows[i + 1].getElementsByTagName("TD")[0];

                        if (n == 1) {
                            if (new Date(x.innerHTML) > new Date(y.innerHTML)) {

                                shouldSwitch = true;
                                break;
                            }
                        } else {
                            if (new Date(x.innerHTML) < new Date(y.innerHTML)) {

                                shouldSwitch = true;
                                break;
                            }
                        }
                    }
                    if (shouldSwitch) {
                        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                        switching = true;
                    }
                }
            }
        }

        function openCityV(evt, cityName) {
            $("#LondonV").html("");
            $("#TokyoV").html("");
            $("#pretragaV1").css("display", "none");
            $("#pretragaV2").css("display", "none");
            zatvoriKomentarV();
            let id = localStorage.getItem("ulogovaniId");



            $.ajax({
                type: 'GET',
                url: '/api/Voznja',
                async: false,
                success: function (data) {

                    if (cityName == "LondonV") {
                        $("#pretragaV1").css("display", "inline");
                        let ulogovani = localStorage.getItem("ulogovani");
                        let tableOfProducts = "<table class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\" id=\"mojeV\"><tr><td>Datum</td><td>Početna lokacija</td><td>Odredište</td> <td colspan=\"2\">Dispečer</td> <td colspan=\"2\">Mušterija</td> <td>Iznos</td><td>Ocena</td> <td>Status</td> <td>Komentar</td><td></td></tr>";
                        for (voznja in data) {
                            if (data[voznja].Vozac == id) {

                                var date = new Date(data[voznja].Datum);
                                var month = date.getMonth() + 1;
                                var day = date.getDate();
                                var hours = date.getHours();
                                var minutes = date.getMinutes();

                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hours < 10) hours = '0' + hours;
                                if (minutes < 10) minutes = '0' + minutes;

                                var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;
                                var date2 = date.getFullYear() + "-" + month + "-" + day;

                                let dispIme = "";
                                let dispPrezime = "";

                                if (data[voznja].Dispecer != -1) {
                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Dispecer/' + data[voznja].Dispecer,
                                        async: false,
                                        success: function (v) {
                                            dispIme = v.Ime;
                                            dispPrezime = v.Prezime;
                                        }
                                    })


                                }
                                let korIme = "";
                                let korPrezime = "";

                                if (data[voznja].Musterija != -1) {

                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Korisnik/' + data[voznja].Musterija,
                                        async: false,
                                        success: function (kor) {
                                            korIme = kor.Ime;
                                            korPrezime = kor.Prezime;
                                        }
                                    })
                                }

                                tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/>  ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${data[voznja].Odrediste.Adresa.Ulica} <br/>  ${data[voznja].Odrediste.Adresa.Mesto}</td><td>${dispIme}</td><td>${dispPrezime}</td><td>${korIme}</td><td>${korPrezime}</td><td>${data[voznja].Iznos}</td><td>${data[voznja].Komentar.Ocena}</td>`;


                                switch (data[voznja].Status) {
                                    case 0:
                                        tableOfProducts += `<td>Kreirana-Na čekanju</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 1:
                                        tableOfProducts += `<td>Formirana</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        tableOfProducts += `<td><button id="uspesna${data[voznja].Id}" type="button" onclick="uspesnaClickV(${data[voznja].Id});">Uspešna</button>`;
                                        tableOfProducts += ` <button id="neuspesna${data[voznja].Id}" type="button" onclick="neuspesnaClickV(${data[voznja].Id});">Neuspešna</button></td>`;

                                        break;
                                    case 2:
                                        tableOfProducts += `<td>Obrađena</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        tableOfProducts += `<td><button id="uspesna${data[voznja].Id}" type="button" onclick="uspesnaClickV(${data[voznja].Id});">Uspešna</button>`;
                                        tableOfProducts += ` <button id="neuspesna${data[voznja].Id}" type="button" onclick="neuspesnaClickV(${data[voznja].Id});">Neuspešna</button></td>`;

                                        break;
                                    case 3:
                                        tableOfProducts += `<td>Prihvaćena</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        tableOfProducts += `<td><button id="uspesna${data[voznja].Id}" type="button" onclick="uspesnaClickV(${data[voznja].Id});">Uspešna</button>`;
                                        tableOfProducts += ` <button id="neuspesna${data[voznja].Id}" type="button" onclick="neuspesnaClickV(${data[voznja].Id});">Neuspešna</button></td>`;

                                        break;
                                    case 4:
                                        tableOfProducts += `<td>Otkazana</td>`;
                                        tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickV(${data[voznja].Id});">Vidi komentar</button></td><td></td>`;

                                        break;
                                    case 5:
                                        tableOfProducts += `<td>Uspešna</td>`;
                                        if (data[voznja].Komentar.Korisnik == -1) {
                                            tableOfProducts += `<td><button id="dodajKomentar${data[voznja].Id}" type="button" onclick="dodajKomentarClickV(${data[voznja].Id});">Dodaj komentar</button></td><td></td>`;

                                        } else {
                                            tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickV(${data[voznja].Id});">Vidi komentar</button></td><td></td>`;

                                        }
                                        break;
                                    case 6:
                                        tableOfProducts += `<td>Neuspešna</td>`;
                                        tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClickV(${data[voznja].Id});">Vidi komentar</button></td><td></td>`;

                                        break;

                                }
                                tableOfProducts += `<td hidden>${data[voznja].Id}</td>`;
                            }
                        }
                        tableOfProducts += "</table>";
                        $("#LondonV").append(tableOfProducts);
                    } else if (cityName == "TokyoV") {
                        $("#pretragaV2").css("display", "inline");
                        let tip = localStorage.getItem("ulogovaniTip");
                        let status = localStorage.getItem("ulogovaniStatus");
                        let tableOfProducts = "<table class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\" id=\"kreiraneV\"><tr><td>Datum</td><td>Početna lokacija</td><td colspan=\"2\">Mušterija</td><td>Tip Automobila</td></tr>";
                        for (voznja in data) {
                            if (data[voznja].Status == 0 && (data[voznja].TipAutomobila == tip || data[voznja].TipAutomobila == 0)) {

                                var date = new Date(data[voznja].Datum);
                                var month = date.getMonth() + 1;
                                var day = date.getDate();
                                var hours = date.getHours();
                                var minutes = date.getMinutes();

                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hours < 10) hours = '0' + hours;
                                if (minutes < 10) minutes = '0' + minutes;

                                var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;
                                var date2 = date.getFullYear() + "-" + month + "-" + day;

                                let korIme = "";
                                let korPrezime = "";

                                let korId = data[voznja].Musterija;

                                if (korId != -1) {

                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Korisnik/' + data[voznja].Musterija,
                                        async: false,
                                        success: function (v) {
                                            korIme = v.Ime;
                                            korPrezime = v.Prezime;
                                        }
                                    })


                                }

                                tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/>  ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${korIme}</td><td>${korPrezime}</td>`;
                                if (data[voznja].TipAutomobila == 0) {
                                    tableOfProducts += `<td>Svejedno</td>`;
                                } else if (data[voznja].TipAutomobila == 1) {
                                    tableOfProducts += `<td>Putnički</td>`;
                                } else if (data[voznja].TipAutomobila == 2) {
                                    tableOfProducts += `<td>Kombi</td>`;
                                }

                                if (status == "true") {
                                    tableOfProducts += `<td><button class="zauzetVozacDugmici" id="preuzmi${data[voznja].Id}" type="button" onclick="preuzmiVoznjuClick(${data[voznja].Id});" disabled>Preuzmi Vožnju</button></td>`;

                                } else {
                                    tableOfProducts += `<td><button class="zauzetVozacDugmici" id="preuzmi${data[voznja].Id}" type="button" onclick="preuzmiVoznjuClick(${data[voznja].Id});">Preuzmi Vožnju</button></td>`;

                                }
                                tableOfProducts += `<td hidden>${data[voznja].Id}</td></tr>`;
                            }
                            
                        }
                        tableOfProducts += "</table>";
                        $("#TokyoV").append(tableOfProducts);

                    }
                }
            });


            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";
        }

    </script>
</head>
<body>
    <div class="w3-container w3-content" style="margin-top:200px" id="mapa">
        <p style="margin-top:50px;margin-left:30px">Kliknite na željenu lokaciju</p>
        
        <div  id="map" style="width:700px;height: 400px;margin-top:30px;margin-left:30px"></div>
    </div>
  
    <div class="musterija">
        <div class="w3-top">
            <div class="w3-bar " style=" background-color:#f176ad">
                <img class="w3-bar-item w3-left w3-small " src="logo.jpg" height="60" width="60" />
                <a href="#" id="homeK" class="w3-bar-item w3-button w3-padding-large w3-large w3-left " style=" background-color:#ee1790"><i class="fa fa-home"></i></a>
                <div class="w3-dropdown-hover w3-hide-small w3-large w3-left">
                    <button class="w3-button w3-padding-large ac" title="Account"><i class="fa fa-user"></i></button>
                    <div class="w3-dropdown-content w3-card-4 w3-bar-block" style="width:300px">
                        <a href="#" id="pregledProfilaK" class="w3-bar-item w3-button">Pregled profila</a>
                        <a href="#" id="izmenaProfilaK" class="w3-bar-item w3-button">Izmeni profil</a>
                        <a href="#" id="odjavaK" class="w3-bar-item w3-button">Odjavi se</a>

                    </div>
                </div>
                <a href="#" id="PlusK" class="w3-bar-item w3-button w3-padding-large w3-large w3-left" title="Nova vožnja"><i class="fa fa-plus"></i></a>
            </div>
        </div>

        <div class="w3-container w3-content" style="max-width:1700px;margin-top:80px">
            <div id="pregledProfilaDivK">
                <div class="w3-card w3-left w3-padding-large">
                    <h5 id="korisnickoImeK" class="fa fa-user-circle w3-xxlarge"></h5>
                    <br />
                    <p id="lozinkaK" class="fa fa-key w3-xlarge"></p><br />
                    <p id="imeK" class="fa fa-genderless w3-xlarge"></p><br />
                    <p id="prezimeK" class="fa fa-genderless w3-xlarge"></p><br />
                    <p id="polK"></p>
                    <p id="jmbgK" class="fa fa-birthday-cake w3-xlarge"></p><br />
                    <p id="kontaktK" class="fa fa-phone w3-xlarge"></p><br />
                    <p id="emailK" class="fa fa-at w3-xlarge"></p><br />
                </div>
            </div>

            <div id="izmenaProfilaDivK">
                <div id="tabelaIzmenaK">

                </div>
                <button class="w3-left" id="izmeniK" type="button">Izmeni</button>
            </div>

            <div id="dodajVoznjuDivK">
                <div id="tabelaDodajVoznju">

                    <table border="1" class="w3-card w3-white">
                        <!--<tr><td colspan="2">Vaša lokacija</td></tr>
                <tr><td>X</td><td><input type="number" name="X" id="xK" required /></td></tr>
                <tr><td>Y</td><td><input type="number" name="Y" id="yK" required /></td></tr>
                <tr><td colspan="2">Adresa</td></tr>
                <tr><td>Ulica</td><td><input type="text" name="Ulica" id="ulicaK" required /></td></tr>
                <tr><td>Broj</td><td><input type="text" name="Broj" id="brojK" required /></td></tr>
                <tr><td>Mesto</td><td><input type="text" name="Mesto" id="mestoK" required /></td></tr>
                <tr><td>ZIP</td><td><input type="number" name="Zip" id="zipK" required /></td></tr>-->
                        <tr>
                            <td>Tip Automobila</td>
                            <td>
                                <select name="Auto" id="autoK">
                                    <option>Svejedno</option>
                                    <option>Putnički</option>
                                    <option>Kombi</option>
                                </select>
                            </td>
                        </tr>
                        <tr><td colspan="2"><button id="dodajVoznjuK" type="button">Dodaj</button></td></tr>
                    </table>
                </div>

            </div>

            <div id="pretragaK">
                <table id="tableK" class="w3-border w3-card" cellpadding="4">
                    <tr>
                        <td>Filtriranje:</td>
                        <td>
                            <select name="Status" id="statusPretragaK">
                                <option value="-1">Status</option>
                                <option value="0">Kreirana</option>
                                <option value="1">Formirana</option>
                                <option value="2">Obrađena</option>
                                <option value="3">Prihvaćena</option>
                                <option value="4">Otkazana</option>
                                <option value="5">Uspešna</option>
                                <option value="6">Neuspešna</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>Datum od</td>
                        <td>Datum do</td>
                    </tr>
                    <tr>
                        <td>Pretraga: </td>
                        <td><input type="date" name="DatumOdK" id="DatumOdK" /></td>
                        <td><input type="date" name="DatumDoK" id="DatumDoK" /></td>
                        <td>
                            <select name="Ocena" id="ocenaPretragaOdK">
                                <option value="0">Ocena od</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                        <td>
                            <select name="Ocena" id="ocenaPretragaDoK">
                                <option value="5">Ocena do</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                        <td>
                            <input type="number" name="cenaOdK" id="cenaOdK" placeholder="Cena od" />
                        </td>
                        <td>
                            <input type="number" name="cenaDoK" id="cenaDoK" placeholder="Cena do" />
                        </td>
                    </tr>


                    <tr>
                        <td><button id="refreshK" type="button"><i class="fa fa-undo"></i></button></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td align="right"><button id="pretraziK" type="button"><i class="fa fa-check-circle"></i></button></td>

                    </tr>
                    <tr>
                        <td>
                            Sortiraj po:
                        </td>
                        <td>
                            <select name="SortK" id="SortK" onchange="sortTableK()">
                                <option value="0">Datumu(Najnoviji)</option>
                                <option value="1">Oceni(najveća-najmanja) </option>
                            </select>
                        </td>
                    </tr>
                </table>

            </div>

            <div class="w3-col m10" style="margin-top:20px">

                <div id="tabelaMojeVoznjeK">

                </div>

            </div>

            <div id="izmenaVoznjeK">

            </div>

            <div class="w3-col m2">
                <div id="dodajKomentarK" class="w3-right">
                    <table border="1" class="w3-card w3-white">
                        <tr>
                            <td colspan="2">Dodaj Komentar</td>
                        </tr>
                        <tr>
                            <td>Opis</td>
                            <td><input type="text" name="Opis" id="opisK" required /></td>
                        </tr>
                        <tr>
                            <td>Ocena</td>
                            <td><input type="range" name="Ocena" id="ocenaK" min="1" max="5" /></td>
                        </tr>
                        <tr>
                            <td> <button onclick="dodajKomentarDugmeK();" type="button">Dodaj</button></td>
                            <td> <button onclick="otkaziKomentarDugmeK();" type="button">Otkazi</button></td>
                        </tr>
                    </table>
                </div>

                <div id="dodajKomentarOtkaziK" class="w3-right">
                    <table border="1" class="w3-card w3-white">
                        <tr>
                            <td colspan="2">Dodaj Komentar</td>
                        </tr>
                        <tr>
                            <td>Opis</td>
                            <td><input type="text" name="Opis" id="opisKO" required /></td>
                        </tr>
                        <tr>
                            <td>Ocena</td>
                            <td><input type="range" name="Ocena" id="ocenaKO" min="1" max="5" value="1" disabled /></td>
                        </tr>
                        <tr>
                            <td colspan="2"> <button class="noBtn" onclick="dodajKomentarOtkaziDugmeK();" type="button">Dodaj</button></td>

                        </tr>
                    </table>
                </div>

                <div id="prikaziKomentarK" class="w3-right w3-large w3-card w3-white">
                    <div class="w3-card w3-padding-large">

                        <p id="opisP" class="fa fa-pencil-alt"></p><br />
                        <p id="datumP" class="fa fa-calendar-alt"></p><br />
                        <p id="korisnikP" class="fa fa-user-circle"></p><br />
                        <p id="OcenaP" class="fa fa-star"></p><br />
                        <button id="gasiKom" onclick="zatvoriKomentarK();" class="fa fa-times"></button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="vozac">
        <div class="w3-top">
            <div class="w3-bar " style=" background-color:#f176ad">
                <img class="w3-bar-item w3-left w3-small " src="logo.jpg" height="60" width="60" />
                <a href="#" id="homeV" class="w3-bar-item w3-button w3-padding-large w3-large w3-left " style=" background-color:#ee1790"><i class="fa fa-home"></i></a>
                <div class="w3-dropdown-hover w3-hide-small w3-large w3-left">
                    <button class="w3-button w3-padding-large ac" title="Account"><i class="fa fa-user"></i></button>
                    <div class="w3-dropdown-content w3-card-4 w3-bar-block" style="width:300px">
                        <a href="#" id="pregledProfilaV" class="w3-bar-item w3-button">Pregled profila</a>
                        <a href="#" id="izmenaProfilaV" class="w3-bar-item w3-button">Izmeni profil</a>
                        <a href="#" id="odjavaV" class="w3-bar-item w3-button">Odjavi se</a>

                    </div>
                </div>
            </div>
        </div>
 
        <div class="w3-container w3-content" style="max-width:1700px;margin-top:80px">
            <div id="pregledProfilaDivV">
                <div class="w3-card w3-left w3-padding-large">
                    <h5 id="korisnickoImeV" class="fa fa-user-circle w3-xxlarge"></h5>
                    <br />
                    <p id="lozinkaV" class="fa fa-key w3-xlarge"></p><br />
                    <p id="imeV" class="fa fa-genderless w3-xlarge"></p><br />
                    <p id="prezimeV" class="fa fa-genderless w3-xlarge"></p><br />
                    <p id="polV"></p>
                    <p id="jmbgV" class="fa fa-birthday-cake w3-xlarge"></p><br />
                    <p id="kontaktV" class="fa fa-phone w3-xlarge"></p><br />
                    <p id="emailV" class="fa fa-at w3-xlarge"></p><br />
                    <p id="lokacijaV" class="fa fa-map-marker w3-xlarge"></p><br />
                    <p id="automobilV" class="fa fa-car w3-xlarge"></p><br />
                </div>
            </div>

            <div id="izmenaProfilaDivV">
                <div id="tabelaIzmenaV">

                </div>
                <button class="w3-left" id="izmeniV" type="button">Izmeni</button>
                <br/>
            </div>

            <div id="uspesnaVoznjaV">
                <table border="1" class="w3-left">

                    <tr>
                        <td>Iznos</td>
                        <td><input type="number" name="Iznos" id="iznosV" min="50" max="9000" required/></td>
                    </tr>
                    <tr>
                        <td colspan="2"> <button onclick="uspesnaVoznjaDugmeV();" type="button">Dodaj</button></td>

                    </tr>
                </table>
            </div>

            <div id="pretragaV1">
                <table id="tableV1" class="w3-border w3-card" cellpadding="4">
                    <tr>
                        <td>Filtriranje:</td>
                        <td>
                            <select name="Status" id="statusPretragaV1">
                                <option value="-1">Status</option>
                                <option value="0">Kreirana</option>
                                <option value="1">Formirana</option>
                                <option value="2">Obrađena</option>
                                <option value="3">Prihvaćena</option>
                                <option value="4">Otkazana</option>
                                <option value="5">Uspešna</option>
                                <option value="6">Neuspešna</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                    <tr>
                        <td></td>
                        <td>Datum od</td>
                        <td>Datum do</td>
                    </tr>
                    <tr>
                        <td>Pretraga: </td>
                        <td><input type="date" name="DatumOdV1" id="DatumOdV1" /></td>
                        <td><input type="date" name="DatumDoV1" id="DatumDoV1" /></td>
                        <td>
                            <select name="Ocena" id="ocenaPretragaOdV1">
                                <option value="0">Ocena od</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                        <td>
                            <select name="Ocena" id="ocenaPretragaDoV1">
                                <option value="5">Ocena do</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                        <td>
                            <input type="number" name="cenaOdV1" id="cenaOdV1" placeholder="Cena od" />
                        </td>
                        <td>
                            <input type="number" name="cenaDoV1" id="cenaDoV1" placeholder="Cena do" />
                        </td>
                    </tr>


                    <tr>
                        <td><button id="refreshV1" type="button"><i class="fa fa-undo"></i></button></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td align="right"><button id="pretraziV1" type="button"><i class="fa fa-check-circle"></i></button></td>

                    </tr>
                    <tr>
                        <td>
                            Sortiraj po:
                        </td>
                        <td>
                            <select name="SortV1" id="SortV1" onchange="sortTableV1()">
                                <option value="0">Datumu(Najnoviji)</option>
                                <option value="1">Oceni(najveća-najmanja) </option>
                                <option value="2">Udaljenosti(najbliže)</option>
                            </select>
                        </td>
                    </tr>
                </table>

            </div>

            <div id="pretragaV2">
                <table id="tableV2" class="w3-border w3-card" cellpadding="4">

                    <tr>
                        <td></td>
                        <td>Datum od</td>
                        <td>Datum do</td>
                    </tr>
                    <tr>
                        <td>Pretraga:</td>
                        <td><input type="date" name="DatumOdV2" id="DatumOdV2" /></td>
                        <td><input type="date" name="DatumDoV2" id="DatumDoV2" /></td>

                    </tr>


                    <tr>
                        <td><button id="refreshV2" type="button"><i class="fa fa-undo"></i></button></td>
                        <td></td>

                        <td align="right"><button id="pretraziV2" type="button"><i class="fa fa-check-circle"></i></button></td>

                    </tr>
                    <tr>
                        <td>
                            Sortiraj po:
                        </td>
                        <td>
                            <select name="SortV2" id="SortV2" onchange="sortTableV2()">
                                <option value="0">Datumu(Najnoviji)</option>
                                <option value="1">Datumu(Najstariji)</option>
                                <option value="2">Udaljenosti(najbliže)</option>
                            </select>
                        </td>
                    </tr>
                </table>

            </div>

            <div class="w3-col m10" style="margin-top:20px">
                <div id="tabeleV" class="w3-left">

                    <div class="tab">
                        <button class="tablinks" onclick="openCityV(event, 'LondonV')">Moje vožnje</button>
                        <button class="tablinks" onclick="openCityV(event, 'TokyoV')">Kreirane vožnje</button>
                    </div>

                    <div id="LondonV" class="tabcontent">

                    </div>


                    <div id="TokyoV" class="tabcontent">

                    </div>

                </div>
            </div>

            <div class="w3-col m2">
                <div id="dodajKomentarV" class="w3-right">
                    <table border="1" class="w3-card w3-white">
                        <tr>
                            <td colspan="2">Dodaj Komentar</td>
                        </tr>
                        <tr>
                            <td>Opis</td>
                            <td><input type="text" name="Opis" id="opisV" required /></td>
                        </tr>
                        <tr>
                            <td>Ocena</td>
                            <td><input type="range" name="Ocena" id="ocenaV" min="1" max="5" /></td>
                        </tr>
                        <tr>
                            <td> <button onclick="dodajKomentarDugmeV();" type="button">Dodaj</button></td>
                            <td> <button onclick="otkaziKomentarDugmeV();" type="button">Otkaži</button></td>
                        </tr>
                    </table>
                </div>

                <div id="dodajKomentarNeuspesnaV" class="w3-right">
                    <table border="1" class="w3-card w3-white">
                        <tr>
                            <td colspan="2">Dodaj Komentar</td>
                        </tr>
                        <tr>
                            <td>Opis</td>
                            <td><input type="text" name="Opis" id="opisVN" required /></td>
                        </tr>
                        <tr>
                            <td>Ocena</td>
                            <td><input type="range" name="Ocena" id="ocenaVN" min="1" max="5" value="1" disabled /></td>
                        </tr>
                        <tr>
                            <td colspan="2"> <button class="noBtn" onclick="dodajKomentarNeuspesnaDugmeV();" type="button">Dodaj</button></td>

                        </tr>
                    </table>
                </div>

                <div id="prikaziKomentarV" class="w3-right w3-large">
                    <div class="w3-card w3-padding-large w3-card w3-white">

                        <p id="opisPV" class="fa fa-pencil-alt"></p><br />
                        <p id="datumPV" class="fa fa-calendar-alt"></p><br />
                        <p id="korisnikPV" class="fa fa-user-circle"></p><br />
                        <p id="OcenaPV" class="fa fa-star"></p><br />
                        <button id="gasiKom" onclick="zatvoriKomentarV();" class="fa fa-times"></button>
                    </div>
                </div>

            </div>



        </div>

        </div>

    <div class="dispecer">
        <div class="w3-top">
            <div class="w3-bar " style=" background-color:#f176ad">
                <img class="w3-bar-item w3-left w3-small " src="logo.jpg" height="60" width="60" />
                <a href="#" id="homeD" class="w3-bar-item w3-button w3-padding-large w3-large w3-left " style=" background-color:#ee1790"><i class="fa fa-home"></i></a>
                <div class="w3-dropdown-hover w3-hide-small w3-large w3-left">
                    <button class="w3-button w3-padding-large" title="Account"><i class="fa fa-user"></i></button>
                    <div class="w3-dropdown-content w3-card-4 w3-bar-block" style="width:300px">
                        <a href="#" id="pregledProfilaD" class="w3-bar-item w3-button">Pregled profila</a>
                        <a href="#" id="izmenaProfilaD" class="w3-bar-item w3-button">Izmeni profil</a>
                        <a href="#" id="odjavaD" class="w3-bar-item w3-button">Odjavi se</a>

                    </div>
                </div>
                <a href="#" id="PlusD" class="w3-bar-item w3-button w3-padding-large w3-large w3-left" title="Dodaj Vozača"><i class="fa fa-user-plus"></i></a>
                <a href="#" id="PlusVoznjaD" class="w3-bar-item w3-button w3-padding-large w3-large w3-left" title="Dodaj Vožnju"><i class="fa fa-plus"></i></a>

                <div class="w3-dropdown-hover w3-hide-small w3-large w3-left">
                    <button class="w3-button w3-padding-large" title="Blokiranje"><i class="fa fa-ban"></i></button>
                    <div class="w3-dropdown-content w3-card-4 w3-bar-block" style="width:300px">
                        <a href="#" id="blokVD" class="w3-bar-item w3-button">Blokiranje Vozača</a>
                        <a href="#" id="blokKD" class="w3-bar-item w3-button">Blokiranje Mušterije</a>
                       
                    </div>
                </div>
            </div>
        </div>

        <div class="w3-container w3-content" style="max-width:1700px;margin-top:80px">
            <div id="pregledProfilaDivD">

                <div class="w3-card w3-left w3-padding-large">
                    <h5 id="korisnickoImeD" class="fa fa-user-circle w3-xxlarge w3-center"></h5><br />
                    <p id="lozinkaD" class="fa fa-key w3-xlarge"></p><br />
                    <p id="imeD" class="fa fa-genderless w3-xlarge"></p><br />
                    <p id="prezimeD" class="fa fa-genderless w3-xlarge"></p><br />
                    <p id="polD"></p>
                    <p id="jmbgD" class="fa fa-birthday-cake w3-xlarge"></p><br />
                    <p id="kontaktD" class="fa fa-phone w3-xlarge"></p><br />
                    <p id="emailD" class="fa fa-at w3-xlarge"></p><br />
                </div>


            </div>

            <div id="izmenaProfilaDivD">
                <div id="tabelaIzmenaD">

                </div>
                <button class="w3-left" id="izmeniD" type="button">Izmeni</button>
            </div>

            <div id="dodajVozacaDivD">
                <table class="w3-large" border="1">
                    <tr><td colspan="2" align="center"> Registracija Vozača</td></tr>
                    <tr><td>Korisničko ime</td><td><input type="text" name="KorisnickoIme" id="korisnickoimeVD" pattern=".{4,}" minlength="4" maxlength="13" required /></td></tr>
                    <tr><td>Lozinka</td><td><input type="password" name="Lozinka" id="lozinkaVD" pattern=".{4,}" minlength="4" maxlength="13" required /></td></tr>
                    <tr><td>Ime</td><td> <input type="text" name="Ime" id="imeVD" minlength="2" maxlength="13" pattern="^[^0-9]+$" required /> </td> </tr>
                    <tr> <td>Prezime</td><td> <input type="text" name="Prezime" id="prezimeVD" minlength="2" maxlength="13" pattern="^[^0-9]+$" required /> </td></tr>
                    <tr><td> Pol </td><td><select name="Pol" id="polVD"><option>Muški</option><option>Ženski</option></select></td></tr>
                    <tr> <td> JMBG</td> <td><input type="text" name="JMBG" id="jmbgVD" pattern="[0-9]{13}" minlength="13" maxlength="13" required /></td></tr>
                    <tr><td> Kontakt</td> <td><input type="text" name="Kontakt" id="kontaktVD" pattern="[0-9]{6,14}" minlength="6" maxlength="14" required /> </td> </tr>
                    <tr><td> Email </td> <td> <input type="email" name="Email" id="emailVD" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" required /></td></tr>
                    <!--<tr><td colspan="2">Lokacija</td></tr>
            <tr><td>X</td><td><input type="number" name="X" id="xVD" required /></td></tr>
            <tr><td>Y</td><td><input type="number" name="Y" id="yVD" required /></td></tr>
            <tr><td colspan="2">Adresa</td></tr>
            <tr><td>Ulica</td><td><input type="text" name="Ulica" id="ulicaVD" required /></td></tr>
            <tr><td>Broj</td><td><input type="text" name="Broj" id="brojVD" required /></td></tr>
            <tr><td>Mesto</td><td><input type="text" name="Mesto" id="mestoVD" required /></td></tr>
            <tr><td>ZIP</td><td><input type="number" name="Zip" id="zipVD" required /></td></tr>-->
                    <tr><td colspan="2">Automobil</td></tr>
                    <tr><td>Godište</td><td><input type="number" name="Godiste" id="godisteVD" min="2000" max="2018" required /></td></tr>
                    <tr><td>Registracija</td><td><input type="text" name="Registracija" id="regVD" pattern="[A-Z]{2}[0-9]{3}[A-Z]{2}" required /></td></tr>
                    <tr><td>Broj Vozila</td><td><input type="number" name="BrojVozila" id="brVD" min="0" max="100" required /></td></tr>
                    <tr><td>Tip</td><td><select name="TipAutomobila" id="tipAutoVD"><option selected>Putnički</option><option>Kombi</option></select></td></tr>

                    <tr><td colspan="2"><button id="registracijaV" type="button">Registruj</button></td></tr>
                </table>
            </div>

            <div id="dodajVoznjuD">



            </div>



            <div id="pretragaD1">
                <table id="tableD1" class="w3-border w3-card" cellpadding="4">
                    <tr>
                        <td>Filtriranje: </td>
                        <td>
                            <select name="Status" id="statusPretragaD1">
                                <option value="-1">Status</option>
                                <option value="0">Kreirana</option>
                                <option value="1">Formirana</option>
                                <option value="2">Obrađena</option>
                                <option value="3">Prihvaćena</option>
                                <option value="4">Otkazana</option>
                                <option value="5">Uspešna</option>
                                <option value="6">Neuspešna</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td> Pretraga: </td>
                        <td>
                            <select name="Uloga" id="ulogaPretragaD1">
                                <option value="0">Mušterija</option>
                                <option value="2">Vozač</option>
                            </select>
                        </td>
                        <td>
                            <input type="text" name="imeD1" id="imeD1" placeholder="Ime" />
                        </td>
                        <td>
                            <input type="text" name="prezimeD1" id="prezimeD1" placeholder="Prezime" />
                        </td>
                        <td>
                            <select name="Ocena" id="ocenaPretragaOdD1">
                                <option value="0">Ocena od</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                        <td>
                            <select name="Ocena" id="ocenaPretragaDoD1">
                                <option value="5">Ocena do</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Datum od</td>
                        <td>Datum do</td>
                    </tr>
                    <tr>
                        <td><input type="date" name="DatumOdD1" id="DatumOdD1" /></td>
                        <td><input type="date" name="DatumDoD1" id="DatumDoD1" /></td>

                        <td>
                            <input type="number" name="cenaOdD1" id="cenaOdD1" placeholder="Cena od" />
                        </td>
                        <td>
                            <input type="number" name="cenaDoD1" id="cenaDoD1" placeholder="Cena do" />
                        </td>
                    </tr>


                    <tr>
                        <td><button id="refreshD1" type="button"><i class="fa fa-undo"></i></button></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>

                        <td align="right"><button id="pretraziD1" type="button"><i class="fa fa-check-circle"></i></button></td>

                    </tr>
                    <tr>
                        <td>
                            Sortiraj po:
                        </td>
                        <td>
                            <select name="SortD1" id="SortD1" onchange="sortTableD1()">
                                <option value="0">Datumu(Najnoviji)</option>
                                <option value="1">Oceni(najveća-najmanja) </option>
                            </select>
                        </td>
                    </tr>
                </table>

            </div>

            <div id="pretragaD2">
                <table id="tableD2" class="w3-border w3-card" cellpadding="4">
                    <tr>
                        <td>Filtriranje: </td>
                        <td>
                            <select name="Status" id="statusPretragaD2">
                                <option value="-1">Status</option>
                                <option value="0">Kreirana</option>
                                <option value="1">Formirana</option>
                                <option value="2">Obrađena</option>
                                <option value="3">Prihvaćena</option>
                                <option value="4">Otkazana</option>
                                <option value="5">Uspešna</option>
                                <option value="6">Neuspešna</option>
                            </select>
                        </td>

                    </tr>
                    <tr>
                        <td> Pretraga: </td>
                        <td>
                            <select name="Uloga" id="ulogaPretragaD2">
                                <option value="0">Mušterija</option>
                                <option value="2">Vozač</option>
                            </select>
                        </td>
                        <td>
                            <input type="text" name="imeD2" id="imeD2" placeholder="Ime" />
                        </td>
                        <td>
                            <input type="text" name="prezimeD2" id="prezimeD2" placeholder="Prezime" />
                        </td>
                        <td>
                            <select name="Ocena" id="ocenaPretragaOdD2">
                                <option value="0">Ocena od</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                        <td>
                            <select name="Ocena" id="ocenaPretragaDoD2">
                                <option value="5">Ocena do</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Datum od</td>
                        <td>Datum do</td>
                    </tr>
                    <tr>
                        <td><input type="date" name="DatumOdD2" id="DatumOdD2" /></td>
                        <td><input type="date" name="DatumDoD2" id="DatumDoD2" /></td>

                        <td>
                            <input type="number" name="cenaOdD2" id="cenaOdD2" placeholder="Cena od" />
                        </td>
                        <td>
                            <input type="number" name="cenaDoD2" id="cenaDoD2" placeholder="Cena do" />
                        </td>
                    </tr>


                    <tr>
                        <td><button id="refreshD2" type="button"><i class="fa fa-undo"></i></button></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>

                        <td align="right"><button id="pretraziD2" type="button"><i class="fa fa-check-circle"></i></button></td>

                    </tr>
                    <tr>
                        <td>
                            Sortiraj po:
                        </td>
                        <td>
                            <select name="SortD2" id="SortD2" onchange="sortTableD2()">
                                <option value="0">Datumu(Najnoviji)</option>
                                <option value="1">Oceni(najveća-najmanja) </option>
                            </select>
                        </td>
                    </tr>
                </table>

            </div>

            <div id="pretragaD3">
                <table id="tableD3" class="w3-border w3-card" cellpadding="4">

                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td>Datum od</td>
                        <td>Datum do</td>
                    </tr>
                    <tr>
                        <td> Pretraga: </td>
                        <td>
                            <select name="Uloga" id="ulogaPretragaD3">
                                <option value="0">Mušterija</option>
                                <option value="2">Vozač</option>
                            </select>
                        </td>
                        <td>
                            <input type="text" name="imeD3" id="imeD3" placeholder="Ime" />
                        </td>
                        <td>
                            <input type="text" name="prezimeD3" id="prezimeD3" placeholder="Prezime" />
                        </td>
                        <td><input type="date" name="DatumOdD3" id="DatumOdD3" /></td>
                        <td><input type="date" name="DatumDoD3" id="DatumDoD3" /></td>
                    </tr>


                    <tr>
                        <td><button id="refreshD3" type="button"><i class="fa fa-undo"></i></button></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>

                        <td align="right"><button id="pretraziD3" type="button"><i class="fa fa-check-circle"></i></button></td>

                    </tr>
                    <tr>
                        <td>
                            Sortiraj po:
                        </td>
                        <td>
                            <select name="SortD3" id="SortD3" onchange="sortTableD3()">
                                <option value="0">Datumu(Najnoviji)</option>
                                <option value="1">Datumu(Najstariji)</option>
                            </select>
                        </td>
                    </tr>
                </table>

            </div>



            <div class="w3-col m10" style="margin-top:20px">
                <div id="tabeleD" class="w3-left">

                    <div class="tab">
                        <button class="tablinks" onclick="openCity(event, 'London')">Moje vožnje</button>
                        <button class="tablinks" onclick="openCity(event, 'Paris')">Sve vožnje</button>
                        <button class="tablinks" onclick="openCity(event, 'Tokyo')">Kreirane vožnje</button>
                    </div>

                    <div id="London" class="tabcontent">

                    </div>

                    <div id="Paris" class="tabcontent">

                    </div>

                    <div id="Tokyo" class="tabcontent">

                    </div>

                </div>
            </div>

            

            <div class="w3-col m2">
                <div class="w3-right w3-card w3-white" id="obradaVoznjeD">

                </div>

                <div id="dodajKomentarD" class="w3-right">
                    <table border="1" class="w3-card w3-white">
                        <tr>
                            <td colspan="2">Dodaj Komentar</td>
                        </tr>
                        <tr>
                            <td>Opis</td>
                            <td><input type="text" name="Opis" id="opisD" required /></td>
                        </tr>
                        <tr>
                            <td>Ocena</td>
                            <td><input type="range" name="Ocena" id="ocenaD" min="1" max="5" /></td>
                        </tr>
                        <tr>
                            <td> <button onclick="dodajKomentarDugmeD();" type="button">Dodaj</button></td>
                            <td> <button onclick="otkaziKomentarDugmeD();" type="button">Otkaži</button></td>

                        </tr>
                    </table>
                </div>

                <div id="prikaziKomentarD" class="w3-right w3-large">
                    <div class="w3-card w3-padding-large w3-card w3-white">

                        <p id="opisPD" class="fa fa-pencil-alt"></p><br />
                        <p id="datumPD" class="fa fa-calendar-alt"></p><br />
                        <p id="korisnikPD" class="fa fa-user-circle"></p><br />
                        <p id="OcenaPD" class="fa fa-star"></p><br />
                        <button id="gasiKom" onclick="zatvoriKomentarD();" class="fa fa-times"></button>
                    </div>
                </div>


            </div>



            <div class="w3-left">
                <div id="blokDivD">

                </div>
            </div>


        </div>
    </div>

    <script>

        function myMap() {

            var mapCanvas = document.getElementById("map");
            var myCenter = new google.maps.LatLng(45.251984, 19.837242);
            var mapOptions = { center: myCenter, zoom: 14 };
            var map = new google.maps.Map(mapCanvas, mapOptions);
            google.maps.event.addListener(map, 'click', function (event) {
                placeMarker(map, event.latLng);
            });
        }

        function placeMarker(map, location) {
            var marker = new google.maps.Marker({
                position: location,
                map: map
            });
            let lok = displayLocation(location.lat(), location.lng());

            var infowindow = new google.maps.InfoWindow({
                content: 'X: ' + location.lat() + '<br>Y: ' + location.lng() + '<br> ' + lok.Ulica + '<br> ' + lok.Mesto

            });
            infowindow.open(map, marker);


        }

        function displayLocation(latitude, longitude) {
            var request = new XMLHttpRequest();
            let adresaM = "";
            var method = 'GET';
            var url = 'http://maps.googleapis.com/maps/api/geocode/json?latlng='
                + latitude + ',' + longitude + '&sensor=true';
            var async = false;

            request.open(method, url, async);
            request.onreadystatechange = function () {
                if (request.readyState == 4 && request.status == 200) {
                    var data = JSON.parse(request.responseText);
                    var address = data.results[0];
                    var value = address.formatted_address.split(",");
                    count = value.length;
                    country = value[count - 1];
                    state = value[count - 2];
                    city = value[count - 3];
                    
                    // document.write(address.formatted_address);
                    adresaM = {
                        Ulica: city,
                        Mesto: state,

                    }
                    lokacijaMapa = {
                        X: latitude,
                        Y: longitude,
                        Adresa: adresaM,
                    };
                    
                }
            };
            request.send();
            return adresaM;
        };



    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBrjeABCsOwW1rhi7eW6_b_fWF8OK2HeiA&callback=myMap"></script>

</body>
</html>
